/*************************************************************************
 * ADOBE CONFIDENTIAL
 * ___________________
 *
 * Copyright 2019 Adobe
 * All Rights Reserved.
 *
 * NOTICE: All information contained herein is, and remains
 * the property of Adobe and its suppliers, if any. The intellectual
 * and technical concepts contained herein are proprietary to Adobe
 * and its suppliers and are protected by all applicable intellectual
 * property laws, including trade secret and copyright laws.
 * Dissemination of this information or reproduction of this material
 * is strictly forbidden unless prior written permission is obtained
 * from Adobe.
 **************************************************************************/

/*! Copyright for external libraries used in ADBMobile library */
/*!
 * JavaScript MD5 1.0.1
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 * 
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
var ADBMobile_platform=function(){function a(a,b){if(!a)return null;try{return b?window.localStorage.setItem(a,b):window.localStorage.removeItem(a),b}catch(c){_logger.error("Failed to store data element: "+c)}return null}function b(a){if(!a)return null;try{return window.localStorage.getItem(a)}catch(b){_logger.error("Failed to retrieve data element: "+b)}return null}function c(a,b,c,d,e,f){if(!a)return _logger.error("HTTPRequestAsync - URL required but was not passed"),null;c=c||{},e=e||500,f=f||function(){};var g=new XMLHttpRequest;g.onreadystatechange=function(){4==g.readyState&&(f(g.status,g.responseText,d||a),f=function(){})},g.timeout=e,g.ontimeout=function(){f(0,null,a),f=function(){}},g.open(b,a,!0),Object.keys(c).forEach(function(a){g.setRequestHeader(a,this[a])},c),g.send(d)}function d(){return"Chromecast resolution"}function e(){return"undefined"!=typeof cast&&cast.receiver?cast.receiver.VERSION:"Chromecast OS"}function f(){return"Chromecast"}function g(){return"Chromecast App ID"}function h(){return g()}function i(){return Math.floor((new Date).getTime()/1e3)}function j(){return(new Date).getTime()}function k(){return(new Date).toISOString()}function l(){return"00/00/0000 00:00:00 0 "+(new Date).getTimezoneOffset()}function m(a,b){return setInterval(a,b)}function n(a){clearInterval(a)}function o(a){return window.btoa(a)}function p(a){return window.atob(a)}function q(a){var b;if(window.DOMParser){b=(new DOMParser).parseFromString(a,"text/xml")}return b}function r(a){return a.item(0)}return{httpRequestAsync:c,writeValue:a,readValue:b,getResolution:d,getDeviceName:f,getOSVersion:e,getAppID:g,getDefaultPageName:h,getTimeSince1970:i,getTimeSince1970Millis:j,getDateInISOString:k,getTimestampString:l,setInterval:m,clearInterval:n,encodeBase64String:o,decodeBase64String:p,parseXML:q,getBaseItem:r}}(),ADBMobile=function(){var a=function(){function a(){i=ADBMobile_platform.readValue("adb_aid"),j=ADBMobile_platform.readValue("adb_ignore_aid")}function b(){return"yxxxxxxxxxxxxxxx-zxxxxxxxxxxxxxxx".replace(/[xyz]/g,function(a){return"0123456789ABCDEF".charAt(Math.floor(Math.random()*({y:7,x:16,z:4}[a]||0)))})}function c(){i=null,j=null,ADBMobile_platform.writeValue("adb_aid",""),ADBMobile_platform.writeValue("adb_ignore_aid","")}function d(a){h.isFunction(a)&&(l.push({callback:a}),f())}function f(){if(!m){var a=l.shift();if(a){m=!0;var c=a.callback,d=!1;do{if(e.getPrivacyStatus()!==e.PRIVACY_STATUS_OPT_IN){c(null);break}if(i){c(i);break}if(j&&e.visitorIDServiceEnabled()){c(null);break}d=!0}while(!1);if(!d)return m=!1,void f();k.getMarketingCloudIDAsync(function(a){var d=(e.ssl()?"https":"http")+"://"+e.trackingServer()+"/id";a&&(d+=k.getAnalyticsIDRequestParameterString()),ADBMobile_platform.httpRequestAsync(d,"GET",{},null,500,function(a,d){if(e.getPrivacyStatus()!==e.PRIVACY_STATUS_OPT_IN)g.debug("[Aid] Dropping response as privacy is not set to opted in."),c(null);else{if(200==a&&d)try{i=JSON.parse(d).id,ADBMobile_platform.writeValue("adb_aid",i)}catch(h){g.debug("[Aid] Error parsing aid call response.")}!i&&e.visitorIDServiceEnabled()?ADBMobile_platform.writeValue("adb_ignore_aid",!0):ADBMobile_platform.readValue("adb_aid")||(i=b(),ADBMobile_platform.writeValue("adb_aid",i)),i&&e.visitorIDServiceEnabled()&&k.idSync({AVID:i}),c(i)}m=!1,f()})})}}}var i,j,l=[],m=!1;return{init:a,getAIDAsync:d,purgeAid:c}}(),b=function(){function a(a,c){var d={};b(c)&&Object.keys(c).forEach(function(a){d[a]=this[a]},c),g(d,{pageName:a||ADBMobile_platform.getDefaultPageName()},ADBMobile_platform.getTimeSince1970())}function b(a){return null!==a&&(void 0!==a&&a.constructor==={}.constructor)}function d(a,c,d){var e={};b(c)&&Object.keys(c).forEach(function(a){e[a]=this[a]},c),e["a.internalaction"]=a;var f={pe:"lnk_o",pev2:"ADBINTERNAL:"+a,pageName:ADBMobile_platform.getDefaultPageName()};g(e,f,d)}function f(a,c){var d={};b(c)&&Object.keys(c).forEach(function(a){d[a]=this[a]},c),d["a.action"]=a;var e={pe:"lnk_o",pev2:"AMACTION:"+a,pageName:ADBMobile_platform.getDefaultPageName()};g(d,e,ADBMobile_platform.getTimeSince1970())}function g(a,b,d){if(e.analyticsEnabled()){a=a||{},b=b||{},d=d||ADBMobile_platform.getTimeSince1970(),a["a.Resolution"]=ADBMobile_platform.getResolution(),a["a.DeviceName"]=ADBMobile_platform.getDeviceName(),a["a.OSVersion"]=ADBMobile_platform.getOSVersion(),a["a.AppID"]=ADBMobile_platform.getAppID();var f=e.getUserIdentifier();f&&(b.vid=f),e.offlineTrackingEnabled()&&(b.ts=d),b.ce=e.characterSet(),b.t=ADBMobile_platform.getTimestampString(),Object.keys(a).forEach(function(a){"&&"===a.slice(0,2)&&(b[a.slice(2)]=this[a],delete this[a])},a);var g="ndh=1"+h.serializeParameters(b)+h.serializeContextData(a);c.queue(g,ADBMobile_platform.getTimeSince1970()),p.checkFor3rdPartyCallbacks(b,a)}}return{trackAction:f,trackState:a,trackInternal:d}}(),c=function(){function b(a,b){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN?(g.debug("Analytics - Queued Hit("+a+")"),l.push({frag:a,ts:b}),c()):g.debug("Analytics - Not queueing hit. Privacy is not set to optedin.")}function c(){if(!m){m=!0;var b=l.shift();if(!b)return void(m=!1);if(!e.offlineTrackingEnabled()){var i=ADBMobile_platform.getTimeSince1970()-b.ts;if(i>60)return g.debug("Analytics - Hit is greater than 60 seconds old ("+i+"s), will be deleted ("+b.frag+")"),m=!1,void c()}k.idSync(null,function(e){var i=b.frag;e&&(i+=h.serializeParameters(k.getAnalyticsParameters())),a.getAIDAsync(function(a){a&&(i+=h.serializeKeyValuePair("aid",a)),ADBMobile_platform.httpRequestAsync(f(),"POST",{"Content-type":"application/x-www-form-urlencoded"},i,2e3,function(a,b,e){if(200==a){g.debug("Analytics - Successfully sent hit ("+e+")");var f=null;if(b)try{f=JSON.parse(b)}catch(h){f=null}f?(g.debug("Analytics - JSON response received: "+b),d.processJsonResponse(f)):g.debug("Analytics - Empty or non JSON response received")}else g.error("Analytics - Unable to send hit ("+e+") response ("+b+")");m=!1,c()})})})}}function f(){var a=e.ssl()?"https":"http";return a+="://"+e.trackingServer()+"/b/ss/"+e.reportSuiteIDs()+"/"+e.getAnalyticsResponseType()+"/"+j.codeVersion+"/s"+Math.floor(1e7*Math.random())}function i(){l=[]}var l=[],m=!1;return{queue:b,purgeAnalyticsQueue:i}}(),d=function(){function a(){if(!v){v=!0;var b=u.shift();if(!b)return void(v=!1);ADBMobile_platform.httpRequestAsync(b,"GET",{},"",2e3,function(b,c,d){if(200==b&&e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN){g.debug("Audience Manager - Successfully Sent Signal ("+d+"), response ("+c+")");var f=null;try{f=JSON.parse(c)}catch(h){g.debug("Audience Manager - Unable to parse response ("+h+")")}f&&t(f)}else g.error("Audience Manager - Unable to send signal ("+d+")");v=!1,a()})}}function b(b){if(e.audienceManagerEnabled())if(e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN){var d=c(b);g.debug("Audience Manager - Queued Signal("+d+")"),u.push(d),a()}else g.debug("Audience Manager - Not queueing hit. Privacy is not set to optedin.")}function c(a){return(d()+f(a)+i()+"&d_ptfm=appletv&d_dst=1&d_rtbd=json").replace(/\?\&/i,"?")}function d(){return e.ssl()?"https":"http://"+e.aamServer()+"/event?"}function f(a){a=a||{};var b="";return Object.keys(a).forEach(function(a){b+=h.serializeKeyValuePair(j(a),this[a])},a),b}function i(){var a="",b=r()||null;b&&(a+=h.serializeKeyValuePair("d_uuid",b));var c=o()||null,d=p()||null;return c&&d&&(a+=h.serializeKeyValuePair("d_dpid",c)+h.serializeKeyValuePair("d_dpuuid",d)),a+=k.getAAMParameterString()}function j(a){return a.replace("/./g","_")}function l(a){var b=JSON.stringify(a);ADBMobile_platform.writeValue("adb_aam_profile",b)}function m(){var a=ADBMobile_platform.readValue("adb_aam_profile");return JSON.parse(a)}function n(a,b){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN&&(ADBMobile_platform.writeValue("adb_aam_dpid",a),ADBMobile_platform.writeValue("adb_aam_dpuuid",b))}function o(){return ADBMobile_platform.readValue("adb_aam_dpid")}function p(){return ADBMobile_platform.readValue("adb_aam_dpuuid")}function q(a){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN&&ADBMobile_platform.writeValue("adb_aam_uuid",a)}function r(){return ADBMobile_platform.readValue("adb_aam_uuid")}function s(){u=[],ADBMobile_platform.writeValue("adb_aam_profile",""),ADBMobile_platform.writeValue("adb_aam_dpid",""),ADBMobile_platform.writeValue("adb_aam_dpuuid",""),ADBMobile_platform.writeValue("adb_aam_uuid","")}function t(a){var b=a.uuid||null;b&&q(b),(a.dests||[]).map(function(a){var b=a.c||null;b&&(g.debug("Audience Manager - Forwarding 'dests' request ("+b+")"),ADBMobile_platform.httpRequestAsync(b,"GET",{},"",2e3,null))});var c=a.stuff||[],d={};c.map(function(a){var b=a.cn||null,c=a.cv||null;b&&c&&(d[b]=c)}),l(d)}var u=[],v=!1;return{getUUID:r,getDpid:o,getDpuuid:p,setDpidAndDpuuid:n,getVisitorProfile:m,submitSignal:b,purgeAamIdsAndQueue:s,processJsonResponse:t}}(),e=function(){function b(){if(x=p()||null,x&&g.debug("Config - Found custom visitor id("+x+")"),"object"!=typeof ADBMobileConfig||null===ADBMobileConfig)return void g.error("Config - Unable to find defined ADBMobileConfig object.");"object"==typeof ADBMobileConfig.analytics&&(B=ADBMobileConfig.analytics.offlineEnabled||!1,y=ADBMobileConfig.analytics.server||null,z=ADBMobileConfig.analytics.rsids||null,A=ADBMobileConfig.analytics.ssl||!1,C=ADBMobileConfig.analytics.lifecycleTimeout||300,D=ADBMobileConfig.analytics.privacyDefault||"optedin"),g.debug((m(),"Enabled")),"object"==typeof ADBMobileConfig.audienceManager&&(E=ADBMobileConfig.audienceManager.server||null,"boolean"==typeof ADBMobileConfig.audienceManager.analyticsForwardingEnabled&&(F=ADBMobileConfig.audienceManager.analyticsForwardingEnabled||!1)),g.debug((j(),"Enabled")),g.debug("Enabled"),"object"==typeof ADBMobileConfig.marketingCloud&&(G=ADBMobileConfig.marketingCloud.org||null,H=ADBMobileConfig.marketingCloud.server||null),g.debug((n(),"Enabled")),"object"==typeof ADBMobileConfig.mediaHeartbeat&&(I=ADBMobileConfig.mediaHeartbeat.server||null,J=ADBMobileConfig.mediaHeartbeat.publisher||null,K=ADBMobileConfig.mediaHeartbeat.channel||null,L=ADBMobileConfig.mediaHeartbeat.playerName||null,M=ADBMobileConfig.mediaHeartbeat.ssl||!1,N=ADBMobileConfig.mediaHeartbeat.ovp||null,O=ADBMobileConfig.mediaHeartbeat.sdkVersion||null),g.debug((i(),"Enabled")),"object"==typeof ADBMobileConfig.messages&&(P=ADBMobileConfig.messages),"object"==typeof ADBMobileConfig.remotes&&(Q=ADBMobileConfig.remotes)}function i(){return!(!I||!m())}function j(){return!!E}function l(){return F?10:0}function m(){return!(!y||!z)}function n(){return!!G}function o(a){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN&&(ADBMobile_platform.writeValue("adb_vid",a),x=a)}function p(){return x}function q(){x=null,ADBMobile_platform.writeValue("adb_vid","")}function r(a){ADBMobile_platform.writeValue("adb_privacy",a),a===e.PRIVACY_STATUS_OPT_OUT&&t()}function s(){var a=ADBMobile_platform.readValue("adb_privacy");return a||D}function t(){a.purgeAid(),e.purgeUserIdentifier(),c.purgeAnalyticsQueue(),d.purgeAamIdsAndQueue(),k.purgeVisitorIdService()}function u(a){h.isFunction(a)&&f.getAllIdentifiersAsync(a)}function v(){return P}function w(){return Q}var x=null,y=null,z=null,A=!1,B=!1,C=300,D="optedin",E=null,F=!1,G=null,H=null,I=null,J=null,K=null,L=null,M=!1,N=null,O=null,P=null,Q=null;return{getAllIdentifiersAsync:u,purgeUserIdentifier:q,trackingServer:function(){return y},reportSuiteIDs:function(){return z},ssl:function(){return A},offlineTrackingEnabled:function(){return B},lifecycleTimeout:function(){return C},characterSet:function(){return"UTF-8"},privacyDefault:function(){return D},aamServer:function(){return E},marketingCloudOrganizationIdentifier:function(){return G},marketingCloudCustomServer:function(){return H},mTrackingServer:function(){return I},mPublisher:function(){return J},mChannel:function(){return K},mPlayerName:function(){return L},mSSL:function(){return M},mOVP:function(){return N},mSDK:function(){return O},audienceManagerEnabled:j,getAnalyticsResponseType:l,analyticsEnabled:m,visitorIDServiceEnabled:n,mediaHearbeatEnabled:i,setUserIdentifier:o,getUserIdentifier:p,setPrivacyStatus:r,getPrivacyStatus:s,getMessages:v,getRemotes:w,init:b}}();e.PRIVACY_STATUS_OPT_IN="optedin",e.PRIVACY_STATUS_OPT_OUT="optedout";var f=function(){function b(a){var b={clbFn:a};h(b),i(b)}function c(a){if(a.mcidReady&&a.aidReady){var b={},c=f();null!==c&&(b.companyContexts=c);var d=[],e=a.mcid;null!==e&&d.push(e);var h=a.aid;null!==h&&d.push(h);var i=j();null!==i&&d.push(i);var k=l();null!==k&&d.push(k);var n=m();if(null!==n&&d.push(n),d.length>0){var o={userIDs:d},p=[];p.push(o),b.users=p}try{var q=JSON.stringify(b);a.clbFn(q)}catch(r){g.debug("identies.callback threw exception  ["+r+"]")}}}function f(){var a=e.marketingCloudOrganizationIdentifier();return n(a)?[{namespace:"imsOrgID",value:a}]:null}function h(a){k.getMarketingCloudIDAsync(function(b){var d=null;n(b)&&(d={namespace:"4",value:b,type:"namespaceId"}),a.mcid=d,a.mcidReady=!0,c(a)})}function i(b){a.getAIDAsync(function(a){var d=null;n(a)&&(d={namespace:"avid",value:a,type:"integrationCode"}),b.aid=d,b.aidReady=!0,c(b)})}function j(){var a=e.getUserIdentifier();if(n(a)){var b=e.reportSuiteIDs();return{namespace:"vid",value:a,type:"analytics",rsids:"string"==typeof b?b.trim().split(/\s*,\s*/):[]}}return null}function l(){var a=d.getUUID();return n(a)?{namespace:"0",value:a,type:"namespaceId"}:null}function m(){var a=d.getDpid(),b=d.getDpuuid();return n(a)&&n(b)?{namespace:a,value:b,type:"namespaceId"}:null}function n(a){return"string"==typeof a&&0!==a.length}return{getAllIdentifiersAsync:b}}(),g=function(){function a(a){"object"==typeof console&&console&&console.log&&console.log(a)}function b(a){h.isFunction(a)&&(k=a)}function c(a){j=a}function d(){return j}function e(b){j&&(a("ADBMobile Warning: "+b),k&&k(b))}function f(b){j&&(a("ADBMobile Debug: "+b),k&&k(b))}function g(b){a("ADBMobile Error: "+b),k&&k(b)}function i(a){var b="["+a+"] ";return{warning:function(a){e(b+a)},debug:function(a){f(b+a)},error:function(a){g(b+a)}}}var j=!1,k=null;return{setDebugLogging:c,getDebugLogging:d,setLoggerCallback:b,warning:e,debug:f,error:g,instanceWithTag:i}}(),h=function(){function a(a){return"&c."+d(e(a))+"&.c"}function b(a,b){return void 0!==b&&null!==b?"&"+encodeURIComponent(a)+"="+encodeURIComponent(b):""}function c(a){var c="";for(var d in a)a.hasOwnProperty(d)&&(c+=b(d,a[d]));return c}function d(a){var c="";return a=a||{},Object.keys(a).forEach(function(a){this[a].v&&(c+=b(a,this[a].v)),this[a].subValues&&(c+="&"+a+"."+d(this[a].subValues)+"&."+a)},a),c}function e(a){var b={},c=f(a);return Object.keys(c).forEach(function(a){var c=this[a];!function a(b,c,d,e){if(!(e>=d.length)){var f=d[e];if(c[f]||(c[f]={}),d.length-1==e)return void(c[f].v=b);c[f].subValues||(c[f].subValues={}),a(b,c[f].subValues,d,e+1)}}(c,b,a.split("."),0)},c),b}function f(a){var b={};return a=a||{},Object.keys(a).forEach(function(a){if("string"==typeof a){var c=a.replace(j,".").replace(k,"");c&&(b[c]=this[a])}},a),b}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function i(a){return"function"==typeof a}var j=new RegExp("([.]){2,}","g"),k=new RegExp("[^0-9a-zA-Z._]|^[.]{1,}|[.]{1,}$","g");return{serializeContextData:a,serializeKeyValuePair:b,serializeParameters:c,isFunction:i,clone:g,append:h}}(),i={};!function(a){"use strict";var b=function(){return this._ts=ADBMobile_platform.getTimeSince1970Millis(),this._interval=null,this._name=null,this._enabled=!1,this._nextTick=null,this};b.prototype.start=function(a,b){this._enabled?g.debug("Timer -  "+this._name+" timer already started."):(g.debug("Timer - starting "+b+" timer with interval ("+a+")"),this._interval=a,this._name=b,this._ts=ADBMobile_platform.getTimeSince1970Millis(),this._nextTick=this._interval,this._enabled=!0)},b.prototype.stop=function(){this._enabled?(g.debug("Timer - stoping "+this._name+" timer."),this._enabled=!1,this._nextTick=0):g.debug("Timer -  "+this._name+" timer already stopped.")},b.prototype.restartWithNewInterval=function(a){g.debug("Timer - restarting "+this._name+" timer with interval ("+a+")"),this._interval=a,this._ts=ADBMobile_platform.getTimeSince1970Millis(),this._nextTick=this._interval,this._enabled=!0},b.prototype.reset=function(){g.debug("Timer - resetting "+this._name),this._ts=ADBMobile_platform.getTimeSince1970Millis(),this._nextTick=this._interval,this._enabled=!0},b.prototype.ticked=function(){var a=!1,b=ADBMobile_platform.getTimeSince1970Millis()-this._ts;return b>=this._nextTick&&(this._nextTick=b+this._interval,a=!0),a},b.prototype.elapsedTime=function(){return ADBMobile_platform.getTimeSince1970Millis()-this._ts},b.prototype.enabled=function(){return this._enabled},a.Timer=b}(i);var j=function(){return{codeVersion:"cc-js-2.2.0.121-0a8f88c",mediaAPILevel:4}}(),k=function(){function a(){m=ADBMobile_platform.readValue("adb_visitor_mid"),n=ADBMobile_platform.readValue("adb_visitor_blob"),o=ADBMobile_platform.readValue("adb_visitor_hint"),p=ADBMobile_platform.readValue("adb_visitor_ttl"),q=ADBMobile_platform.readValue("adb_visitor_sync");var a=e.marketingCloudCustomServer();"string"==typeof a&&(r.debug("Setting custom ID server "+a),u=a)}function b(){return"yxxxxxxxxxxxxxxxxxxyxxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return""+Math.floor(10*Math.random())}).replace(/[y]/g,function(){return""+Math.floor(9*Math.random())})}function c(a,b){h.isFunction(b)||(b=function(){}),s.push({identifiers:a,callback:b}),d()}function d(){if(!t){var a=s.shift();if(a){t=!0;var c=a.identifiers,f=a.callback,g=!1;do{if(e.getPrivacyStatus()!==e.PRIVACY_STATUS_OPT_IN){r.debug("Not syncing ID. Privacy is not set to opted in."),f(null);break}if(!e.visitorIDServiceEnabled()){f(null);break}var i=ADBMobile_platform.getTimeSince1970()-q>p;if(m&&!c&&!i){f(m);break}g=!0}while(!1);if(!g)return t=!1,void d();var j=e.marketingCloudOrganizationIdentifier(),k=e.ssl()?"https":"http";k+="://"+u+"/id?d_rtbd=json&d_ver=2&d_orgid="+j,n&&(k+=h.serializeKeyValuePair("d_blob",n)),m&&(k+=h.serializeKeyValuePair("d_mid",m)),o&&(k+=h.serializeKeyValuePair("dcs_region",o)),c&&Object.keys(c).forEach(function(a){k+="&d_cid_ic="+encodeURIComponent(a)+"%01"+encodeURIComponent(this[a])},c),r.debug("Sending id sync call ("+k+")"),ADBMobile_platform.httpRequestAsync(k,"GET",{},null,2e3,function(a,c){if(e.getPrivacyStatus()!==e.PRIVACY_STATUS_OPT_IN)r.debug("Dropping response as privacy is not set to opted in."),f(null);else{do{if(200!==a){r.error("Failed id sync call ("+a+")");break}if(!c){r.error("Blank response from id sync call");break}r.debug("Received response from server ("+c+")");var g;try{g=JSON.parse(c)}catch(h){g=null}g?g.error_msg?r.error("Error received from server("+g.error_msg+")"):g.d_mid?(m=g.d_mid,n=g.d_blob,o=g.dcs_region,p=g.id_sync_ttl||0):(m=b(),n=null,o=null,p=600):r.error("Unable to parse response("+c+")")}while(!1);q=ADBMobile_platform.getTimeSince1970(),ADBMobile_platform.writeValue("adb_visitor_mid",m),ADBMobile_platform.writeValue("adb_visitor_blob",n),ADBMobile_platform.writeValue("adb_visitor_hint",o),ADBMobile_platform.writeValue("adb_visitor_ttl",p),ADBMobile_platform.writeValue("adb_visitor_sync",q),f(m)}t=!1,d()})}}}function f(a){c(null,a)}function i(){return m?"?mid="+m+"&mcorgid="+e.marketingCloudOrganizationIdentifier():""}function j(){var a={};return m?(a.mid=m,n&&(a.aamb=n),o&&(a.aamlh=o),a):a}function k(){var a="";return m?(a+=h.serializeKeyValuePair("d_mid",m),n&&(a+=h.serializeKeyValuePair("d_blob",n)),o&&(a+=h.serializeKeyValuePair("dcs_region",o)),a):a}function l(){m=null,n=null,o=null,p=null,q=null,ADBMobile_platform.writeValue("adb_visitor_mid",""),ADBMobile_platform.writeValue("adb_visitor_blob",""),ADBMobile_platform.writeValue("adb_visitor_hint",""),ADBMobile_platform.writeValue("adb_visitor_ttl",""),ADBMobile_platform.writeValue("adb_visitor_sync","")}var m,n,o,p,q,r=g.instanceWithTag("Id Service"),s=[],t=!1,u="dpm.demdex.net";return{init:a,getMarketingCloudIDAsync:f,idSync:c,getAnalyticsParameters:j,getAnalyticsIDRequestParameterString:i,getAAMParameterString:k,purgeVisitorIdService:l}}(),l={};!function(a){var b={Start:"start",Play:"play",Pause:"pause",Buffer:"buffer",Stall:"stall"},c={SourceApplication:"sourceErrorExternal",SourcePlayer:"sourceErrorSDK"},d={AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdBreakSkip:"adBreakSkip",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",BufferComplete:"bufferComplete",BitrateChange:"bitrateChange"},e={StandardMediaMetadata:"media_standard_content_metadata",StandardAdMetadata:"media_standard_ad_metadata",MediaResumed:"resumed",PrerollTrackingWaitingTime:"prerolltrackingwaitingtime",StandardVideoMetadata:"media_standard_content_metadata",VideoResumed:"resumed"},f={Audio:"audio",Video:"video"},g={VOD:"vod",LIVE:"live",LINEAR:"linear",PODCAST:"podcast",AUDIOBOOK:"audiobook",AOD:"aod"},h={SHOW:"a.media.show",SEASON:"a.media.season",EPISODE:"a.media.episode",ASSET_ID:"a.media.asset",GENRE:"a.media.genre",FIRST_AIR_DATE:"a.media.airDate",FIRST_DIGITAL_DATE:"a.media.digitalDate",RATING:"a.media.rating",ORIGINATOR:"a.media.originator",NETWORK:"a.media.network",SHOW_TYPE:"a.media.type",AD_LOAD:"a.media.adLoad",MVPD:"a.media.pass.mvpd",AUTHORIZED:"a.media.pass.auth",DAY_PART:"a.media.dayPart",FEED:"a.media.feed",STREAM_FORMAT:"a.media.format"},i={ARTIST:"a.media.artist",ALBUM:"a.media.album",LABEL:"a.media.label",AUTHOR:"a.media.author",STATION:"a.media.station",PUBLISHER:"a.media.publisher"},j={ADVERTISER:"a.media.ad.advertiser",CAMPAIGN_ID:"a.media.ad.campaign",CREATIVE_ID:"a.media.ad.creative",PLACEMENT_ID:"a.media.ad.placement",SITE_ID:"a.media.ad.site",CREATIVE_URL:"a.media.ad.creativeURL"};a.Constants={PlayerEvent:b,Error:c,Event:d,MediaType:f,StreamType:g,MediaObjectKey:e,VideoMetadataKeys:h,AudioMetadataKeys:i,AdMetadataKeys:j}}(l),function(a){"use strict";function b(){this._processAction=!0,this._store={}}function c(){this._rules=[]}var d=g.instanceWithTag("media/RuleEngine");b.prototype.setRuleName=function(a){this._ruleName=a},b.prototype.getRuleName=function(){return this._ruleName},b.prototype.setData=function(a,b){this._store[a]=b},b.prototype.getData=function(a){return this._store[a]},b.prototype.shouldProcessAction=function(){return this._processAction},b.prototype.stopProcessingAction=function(){this._processAction=!1},b.prototype.startProcessingAction=function(){this._processAction=!0},c.createContext=function(){return new b},c.createPredicate=function(a,b,c){return{fn:a,expectedValue:b,msg:c}},c.prototype.registerRule=function(a,b,c,d,e){this._rules.push({name:a,desc:b,preconditions:c,actions:d,scope:e})},c.prototype.registerEnterExitAction=function(a,b){this._enterAction=a,this._exitAction=b},c.prototype._handleFailure=function(a,b){d.error(a.desc+" -  "+b.msg)},c.prototype._getRule=function(a){for(var b=0;b<this._rules.length;++b)if(this._rules[b].name===a)return this._rules[b];return null},c.prototype.processRule=function(a,b){var e=!0,f=this._getRule(a);if(f){var g=f.scope;b||(b=c.createContext()),b.setRuleName(a);for(var h=!1,i=0;i<f.preconditions.length;++i){var j=f.preconditions[i];if(h=!!j.fn.call(g,b)!==j.expectedValue){this._handleFailure(f,j);break}}if(h)e=!1;else{b.startProcessingAction(),this._enterAction&&this._enterAction.call(g,b);for(var i=0;i<f.actions.length;++i){var k=f.actions[i];if(!b.shouldProcessAction()){d.debug("Stopping actions for "+f.desc);break}k.call(g,b)}this._exitAction&&b.shouldProcessAction()&&this._exitAction.call(g,b)}}else d.warning("No registered event found for ruleName "+a),e=!1;return e},a.RuleEngine=c}(l),function(a){"use strict";function b(){this.id="",this.name="",this.length=0,this.streamType=x.VOD,this.mediaType=w.Video}function c(){this.name=null,this.startTime=null,this.position=0,this.playerName=null}function d(){this.id="",this.name="",this.length=0,this.position=0}function e(){this.name="",this.length=0,this.position=0,this.offset=0}function f(){this.bitrate=0,this.fps=0,this.droppedFrames=0,this.startupTime=0}function h(a,c,d,e,f){var g=new b;return g.name=a,g.id=c,g.length=d,g.streamType=e,g.mediaType=f!==w.Audio?w.Video:w.Audio,g}function i(a,b,d,e){var f=new c;return f.name=a,f.position=b,f.startTime=d,f.playerName=e,f}function j(a,b,c,e){var f=new d;return f.name=a,f.id=b,f.position=c,f.length=e,f}function k(a,b,c,d){var f=new e;return f.name=a,f.position=b,f.length=c,f.offset=d,f}function l(a,b,c,d){var e=new f;return e.bitrate=a,e.startupTime=b,e.fps=c,e.droppedFrames=d,e}function m(a){return!!a&&(void 0===a.id?(v.warning("MediaInfo does not have value for media-id"),!1):void 0!==a.length||(v.warning("MediaInfo does not have value for playhead"),!1))}function n(a){return!!a&&(void 0!==a.position||(v.warning("AdBreak Info does not have value for position"),!1))}function o(a){return!!a&&(void 0!==a.id||(v.warning("Ad Info does not have value for ad id"),!1))}function p(a){return!!a&&(void 0===a.position?(v.warning("Chapter Info does not have value for chapter position"),!1):void 0===a.name?(v.warning("Chapter Info does not have value for chapter name"),!1):void 0===a.offset?(v.warning("Chapter Info does not have value for chapter offset"),!1):void 0!==a.length||(v.warning("Chapter Info does not have value for chapter length"),!1))}function q(a){return!!a&&(void 0===a.droppedFrames?(v.warning("QoS Info does not have value for dropped frames"),!1):void 0===a.startupTime?(v.warning("QoS Info does not have value for startup time"),!1):void 0===a.fps?(v.warning("QoS Info does not have value for frames per second"),!1):void 0!==a.bitrate||(v.warning("QoS Info does not have value for bitrate"),!1))}function r(a){return!!a&&(a.mSDK()?a.mChannel()?a.mOVP()?!!a.mPlayerName()||(v.warning("Config object does not have value for playername."),!1):(v.warning("Config object does not have value for ovp."),!1):(v.warning("Config object does not have value for channel."),!1):(v.warning("Config object does not have value for sdk."),!1))}function s(a,b){return a===b||null!=a&&"object"==typeof a&&null!=b&&"object"==typeof b&&(a.name===b.name&&(a.position===b.position&&(a.startTime===b.startTime&&a.playerName===b.playerName)))}function t(a,b){return a===b||null!=a&&"object"==typeof a&&null!=b&&"object"==typeof b&&(a.id===b.id&&(a.name===b.name&&(a.length===b.length&&a.position===b.position)))}function u(a,b){return a===b||null!=a&&"object"==typeof a&&null!=b&&"object"==typeof b&&(a.name===b.name&&(a.length===b.length&&(a.position===b.position&&a.offset===b.offset)))}var v=g.instanceWithTag("media/MediaObject"),w=a.Constants.MediaType,x=a.Constants.StreamType;a.MediaObject={MediaInfo:b,AdBreakInfo:c,AdInfo:d,ChapterInfo:e,QoSInfo:f,createMediaObject:h,createAdBreakObject:i,createAdObject:j,createChapterObject:k,createQoSObject:l,isValidMediaInfoObject:m,isValidAdBreakInfoObject:n,isValidAdInfoObject:o,isValidChapterInfoObject:p,isValidQoSInfoObject:q,isValidConfigObject:r,isSameAdBreakInfoObject:s,isSameAdInfoObject:t,isSameChapterInfoObject:u}}(l),function(a){function b(a){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN?(n.debug("Queued Hit"),this._queue.push(a),i.call(this)):n.debug("Not queueing hit. Privacy is not set to optedin.")}function c(a){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN?(n.debug("Queued Hit"),this._asyncQueue.push(a)):n.debug("Not queueing hit. Privacy is not set to optedin.")}function d(){if(this._asyncQueue.length>0){n.debug("Flush requests. Pending requests : "+this._asyncQueue.length);var a=function(){};for(var b in this._asyncQueue)if(this._asyncQueue.hasOwnProperty(b)){var c=j.call(this,this._asyncQueue[b]);n.debug("Sending the Media Heartbeat Hit ("+c+")"),ADBMobile_platform.httpRequestAsync(c,"GET",{},"",2e3,a)}this._asyncQueue=[]}}function f(a,b,c){if(200==a)if(n.debug("Successfully sent hit with response data:"+b),b){var d=ADBMobile_platform.parseXML(b),e={};n.debug("XML response ("+d+")");var f=d.getElementsByTagName("trackingInterval");f&&f.length>0&&(e.trackingInterval=parseInt(ADBMobile_platform.getBaseItem(f).textContent)),f=d.getElementsByTagName("trackExternalErrors"),f&&f.length>0&&(e.trackExternalErrors=parseInt(ADBMobile_platform.getBaseItem(f).textContent)),f=d.getElementsByTagName("setupCheckInterval"),f&&f.length>0&&(e.setupCheckInterval=parseInt(ADBMobile_platform.getBaseItem(f).textContent)),f=d.getElementsByTagName("trackingDisabled"),f&&f.length>0&&(e.trackingDisabled=1==parseInt(ADBMobile_platform.getBaseItem(f).textContent)),this._settingsFn&&this._settingsFn(e)}else n.debug("Empty or invalid XML response received");else n.error("Unable to send hit: "+c),n.debug("Response code "+a);this._currentHit=null,i.call(this)}function i(){if(this._queue.length>0&&!this._currentHit){this._currentHit=this._queue.shift();var a=this,b=j.call(this,this._currentHit);n.debug("Sending the Media Heartbeat Hit ("+b+")"),ADBMobile_platform.httpRequestAsync(b,"GET",{},"",2e3,function(b,c,d){f.call(a,b,c,d)})}}function j(a){var b=!1;a.r&&(b=!0);var c=h.serializeParameters(a);return c.length>2&&(c=c.substring(1)),k.call(this,b)+c}function k(a){var b="";if(e.mTrackingServer){if(b=e.mSSL()?"https":"http",b=b+"://"+e.mTrackingServer(),a){b=b+"/settings/"+e.mPublisher().replace(o,"-")+".xml"}b+="?"}return b}function l(){var a={r:ADBMobile_platform.getTimeSince1970()};b.call(this,a)}function m(a){if(!a)throw new Error("Error initializing serializeAndSendHeartbeat");this._settingsFn=a,this._asyncQueue=[],this._queue=[],this._currentHit=null}var n=g.instanceWithTag("media/SerializeAndSendHeartbeat"),o=new RegExp("[^a-zA-Z0-9]+","g");a._serializeAndSendHeartbeat={init:m,queueRequestsForResponse:b,queueAsyncRequest:c,flushAsyncRequests:d,asyncStatusRequest:l}}(l),function(a){"use strict";function b(a,b,c){this.taskFn=a,this.scope=b,this.interval=c,this.remainingInterval=c}function c(){this._tasks=[],this._pausedTasks=[]}var d=g.instanceWithTag("media/TaskScheduler");b.prototype.elapsedTime=function(a){this.remainingInterval-=a},b.prototype.shouldExecute=function(){return this.remainingInterval<=0},b.prototype.execute=function(){this.taskFn.call(this.scope)},c.prototype._getCurrentTimeInMS=function(){return(new Date).getTime()},c.prototype._runTasksForTime=function(a){var b=[],c=a-this._lastTickTime;this._lastTickTime=a;for(var d=0;d<this._tasks.length;){var e=this._tasks[d];e.elapsedTime(c),e.shouldExecute()?(b.push(e),this._tasks.splice(d,1)):++d}this._checkStopTimer();for(var f=0;f<b.length;++f)b[f].execute()},c.prototype._onTick=function(){var a=this._getCurrentTimeInMS();this._runTasksForTime(a)},c.prototype._startTimer=function(){var a=this;this._timer||(d.debug("#startTimer()"),a._lastTickTime=this._getCurrentTimeInMS(),this._timer=ADBMobile_platform.setInterval(function(){a._onTick()},e))},c.prototype._stopTimer=function(){this._timer&&(d.debug("#stopTimer()"),ADBMobile_platform.clearInterval(this._timer),this._timer=null)},c.prototype._checkStartTimer=function(){this._tasks.length>0&&this._startTimer()},c.prototype._checkStopTimer=function(){0===this._tasks.length&&this._stopTimer()},c.prototype._removeTask=function(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return a.splice(c,1),!0;return!1},c.prototype.scheduleTask=function(a,c,e){if(d.debug("#scheduleTask()"),!a)throw new Error("Reference to the taskFn cannot be NULL");var f=new b(a,c,e);return this._tasks.push(f),this._checkStartTimer(),f},c.prototype.cancelTask=function(a){d.debug("#cancelTask()"),this._removeTask(this._tasks,a),this._checkStopTimer()},c.prototype.pauseTask=function(a){d.debug("#pauseTask()"),this._removeTask(this._tasks,a)&&this._pausedTasks.push(a),this._checkStopTimer()},c.prototype.resumeTask=function(a){d.debug("#resumeTask()"),this._removeTask(this._pausedTasks,a)&&this._tasks.push(a),this._checkStartTimer()},c.prototype.clearTasks=function(){
this._stopTimer(),this._tasks=[],this._pausedTasks=[]};var e=250;a.TaskScheduler=c}(l),function(a){function b(a,b,c){var d=this._timers[a];d&&(d.timerHandle.restartWithNewInterval(b),o.debug("Updated timer:"+a+" to interval:"+b),c&&(o.debug("Updating the defaultInterval for timer:"+a+" from:"+d.defaultInterval+" to:"+b),d.defaultInterval=b))}function c(a){var b=m.call(this,a);return!!(b&&b.enabled()&&b.ticked())}function d(){var a=this;Object.keys(this._timers).forEach(function(b){a._timers[b].autoStart&&j.call(a,b)}),this._active=!0,this._intervalContext=ADBMobile_platform.setInterval(function(){e.call(a)},250)}function e(){var a=this;Object.keys(this._timers).forEach(function(b){c.call(a,b)&&a._callbackFn&&a._callbackFn(b)})}function f(){if(h.call(this)){var a=this;Object.keys(this._timers).forEach(function(b){k.call(a,b)}),this._active=!1}}function h(){return this._active}function j(a){var b=this._timers[a];b&&(o.debug("#startTimer starting timer name:"+a),b.timerHandle.start(b.defaultInterval,a))}function k(a){var b=this._timers[a];b&&(o.debug("#stopTimer stopping timer name:"+a),b.timerHandle.stop())}function l(a,b,c){var d={};d.timerHandle=new p,d.defaultInterval=b,d.autoStart=c,this._timers[a]=d,o.debug("#addTimer added timer name:"+a+" interval:"+b)}function m(a){var b=this._timers[a];return b?b.timerHandle:null}function n(a){if(!a)throw new Error("Error initializing ClockService.");this._callbackFn=a,this._reporting_timer="ReportingTimer",this._checkstatus_timer="CheckStatusTimer",this._flushfilter_timer="FlushFilterTimer",this._playhead_timer="PlayheadTimer",this._active=!1,this._timers={},l.call(this,this._reporting_timer,1e4,!0),l.call(this,this._checkstatus_timer,18e4,!0),l.call(this,this._flushfilter_timer,250,!0),l.call(this,this._playhead_timer,1e3,!1)}var o=g.instanceWithTag("media/ClockService"),p=i.Timer;a._clockservice={restartWithNewInterval:b,startClockService:d,stopClockService:f,startTimer:j,stopTimer:k,isActive:h,getTimerHandle:m,init:n}}(l),function(b){function c(){this.delegate=null,this.resetState()}function d(a){this.isInAdValue=a}function f(a){this._isActiveTrackingValue=a}function h(a){this.isInChapterValue=a}function i(){return this._isActiveTrackingValue}function j(a){this._isBufferingValue=a,$.call(this)}function l(){return this._isBufferingValue}function m(a){this._isPausedValue=a,this._playbackStared=!0,$.call(this)}function n(){return this._isPausedValue}function o(){return this._playbackStared&&!this._isPausedValue&&!this._isSeekingValue&&!this._isBufferingValue}function p(){return this._playbackStared}function q(a){this._isSeekingValue=a,$.call(this)}function r(){return this._isSeekingValue}function s(a){this._isInStallValue=a,$.call(this)}function t(){return this._isInStallValue}function u(){return!!this.getAdBreakInfo()}function v(){return this.isInAdValue}function w(){return this.isInChapterValue}function x(){return this._isSessionActive}function y(a){this._isSessionActive=a}function z(){return this.currMediaInfo}function A(){return this.currAdBreakInfo}function B(){return this.currAdInfo}function C(){return this.currChapterInfo}function D(){var a;return this.delegate&&"function"==typeof this.delegate.getQoSObject?a=this.delegate.getQoSObject():this.delegate&&"function"==typeof this.delegate.getQoSInfo&&(a=this.delegate.getQoSInfo()),a?fa.isValidQoSInfoObject(a)||(ea.warning("QoSInfo object is not valid"),a=null):ea.warning("QoSInfo object not set."),a}function E(){var a=this.currMediaContextData;return a||ea.debug("Media context data is not set."),a}function F(){var a=this.currChapterContextData;return a||ea.debug("Chapter context data is not set."),a}function G(){var a=this.currAdContextData;return a||ea.debug("Ad context data is not set."),a}function H(a){this.currMediaInfo=a}function I(a){this.currAdBreakInfo=a}function J(a){this.currAdInfo=a}function K(a){this.currChapterInfo=a}function L(a){this.currMediaContextData=a}function M(a){this.currAdContextData=a}function N(a){this.currChapterContextData=a}function O(){this.eventTSMap={},this.assetRefContext={},this.setInAdTo(!1),this.setAdInfo(null),this.setAdContextData(null),this.setInChapterTo(!1),this.setChapterInfo(null),this.setChapterContextData(null),this.setAdBreakInfo(null)}function P(){this.setIsActiveTracking(!1),this.setIsActiveSession(!1),this._playbackStared=!1,this._isBufferingValue=!1,this._isInStallValue=!1,this._isPausedValue=!1,this._isSeekingValue=!1,this._forceBufferValue=!1,this._isVideoIdleValue=!1,this._idleStateTS=ADBMobile_platform.getTimeSince1970Millis(),this._playhead=0,this.mid=null,this.mid_start=!1,this.aid=null,this.aid_start=!1,this.setMediaInfo(null),this.setMediaContextData(null),O.call(this)}function Q(){this.assetRefContext.state=Z.call(this),this.assetRefContext.ts=ADBMobile_platform.getTimeSince1970Millis(),this.assetRefContext.playhead=this._playhead}function R(a){this._forceBufferValue=a}function S(){return this._forceBufferValue}function T(){return this.assetRefContext}function U(a,b){this.eventTSMap[a]=b}function V(a){return this.eventTSMap[a]||(this.eventTSMap[a]="-1"),this.eventTSMap[a]}function W(a){a&&(!a||"function"!=typeof a.getCurrentPlaybackTime||"function"!=typeof a.getQoSInfo&&"function"!=typeof a.getQoSObject)?ea.error("setDelegate error. The delegate object is required to have the following functions: getCurrentPlaybackTime, getQoSInfo"):this.delegate=a}function X(){return this.delegate}function Y(){return this.delegate?(this._playhead=this.delegate.getCurrentPlaybackTime(),this._playhead):(ea.error("Please set the media delegate before starting the video tracking."),-1)}function Z(){return this.isInForcedBufferState()?ga.Buffer:this.isInStall()?ga.Stall:this.isBuffering()?ga.Buffer:this.isPaused()||this.isSeeking()?ga.Pause:this.isPlaying()?ga.Play:ga.Start}function $(){var a=this.isPaused()||this.isBuffering()||this.isSeeking()||this.isInStall();a!=this.isVideoIdle()&&(this._idleStateTS=ADBMobile_platform.getTimeSince1970Millis()),this._isVideoIdleValue=a}function _(){if(this.isVideoIdle()){var a=this._idleStateTS;return ADBMobile_platform.getTimeSince1970Millis()-a}return 0}function aa(){return this._isVideoIdleValue}function ba(){if(!this.mid_start){var a=this;this.mid_start=!0,k.getMarketingCloudIDAsync(function(b){a.mid=b})}return this.mid}function ca(){if(!this.aid_start){var b=this;this.aid_start=!0,a.getAIDAsync(function(a){b.aid=a})}return this.aid}function da(){return e.getUserIdentifier()}var ea=g.instanceWithTag("media/MediaContext"),fa=b.MediaObject,ga=b.Constants.PlayerEvent;b._mediacontext={init:c,setInAdTo:d,setIsActiveTracking:f,setInChapterTo:h,isActiveTracking:i,isPaused:n,isPlaying:o,isSeeking:r,isBuffering:l,isInStall:t,hasPlaybackStarted:p,isInAd:v,isInAdBreak:u,isInChapter:w,isActiveSession:x,setIsActiveSession:y,setInPaused:m,setInSeeking:q,setInBuffering:j,setInStall:s,getMediaInfo:z,getAdBreakInfo:A,getAdInfo:B,getChapterInfo:C,getQoSInfo:D,getMediaContextData:E,getChapterContextData:F,getAdContextData:G,setMediaInfo:H,setAdBreakInfo:I,setAdInfo:J,setChapterInfo:K,setMediaContextData:L,setAdContextData:M,setChapterContextData:N,resetState:P,resetToResumeState:O,resetAssetRefContext:Q,updateTimeStampForEvent:U,getCurrentPlayhead:Y,getCurrentPlaybackState:Z,getAssetRefContext:T,getTimeStampForEvent:V,getDurationSinceIdleState:_,isVideoIdle:aa,getVisitorID:ba,getAdobeAnalyticsID:ca,getUserID:da,setDelegate:W,getDelegate:X,forceStateToBuffering:R,isInForcedBufferState:S}}(l),function(a){function b(){var a={};return a[this._analytics_rsid]=null,a[this._analytics_trackingserver]=null,a[this._analytics_ssl]=null,a[this._user_aid]=null,a[this._user_mid]=null,a[this._user_vid]=null,a[this._cuser_id]=null,a[this._cuser_puuid]=null,a[this._service_ovp]=null,a[this._service_sdk]=null,a[this._service_channel]=null,a[this._service_playername]=null,a[this._service_hbversion]=null,a[this._service_apilevel]=null,a[this._event_sid]=null,a[this._event_type]=null,a[this._event_duration]=null,a[this._event_playhead]=null,a[this._event_ts]=null,a[this._event_prevts]=null,a[this._asset_type]=null,a[this._asset_mediaid]=null,a[this._asset_publisher]=null,a[this._asset_length]=null,a[this._asset_name]=null,a[this._asset_adid]=null,a[this._asset_adsid]=null,a[this._asset_adname]=null,a[this._asset_adlength]=null,a[this._asset_resolver]=null,a[this._asset_podid]=null,a[this._asset_adposition_in_pod]=null,a[this._asset_podname]=null,a[this._asset_podoffset]=null,a[this._stream_chapterid]=null,a[this._stream_chaptersid]=null,a[this._stream_chaptername]=null,a[this._stream_chapterpos]=null,a[this._stream_chapterlength]=null,a[this._stream_chapteroffset]=null,a[this._stream_type]=null,a[this._stream_bitrate]=null,a[this._stream_fps]=null,a[this._stream_droppedFrames]=null,a[this._stream_startup_time]=null,a}function c(a){var c=b.call(this);return n.call(this,c),o.call(this,c),p.call(this,c),q.call(this,c),s.call(this,c),r.call(this,c),a==this._aa_start?(t.call(this,c,a),m.call(this,c)):a==this._aa_ad_start?t.call(this,c,a):a==this._media_start?(this._mediaSessionIdValue=null,t.call(this,c,"start"),y.call(this,c)):a==this._ad_start?(this._adSessionIdValue=null,t.call(this,c,"start"),y.call(this,c),z.call(this,c)):a==this._ad_complete?t.call(this,c,"complete"):a==this._chapter_start?(this._chapterSessionIdValue=null,t.call(this,c,a),y.call(this,c),A.call(this,c)):a==this._chapter_complete?t.call(this,c,a):a==this._bitrate_change?t.call(this,c,a):a==this._media_complete?t.call(this,c,"complete"):a==this._media_end?t.call(this,c,"end"):t.call(this,c,a),c[this._event_sid]=B.call(this),J.isInAd()&&a!==this._media_end&&a!==this._chapter_start&&a!==this._chapter_complete&&w.call(this,c),J.isInChapter()&&a!==this._media_end&&x.call(this,c),c}function f(a){var b,c,f={};if(a==this._media_start)b=J.getMediaContextData(),b&&h.append(f,b),c=J.getMediaInfo(),f["a.contentType"]=c.streamType,f["a.media.name"]=c.id,f["a.media.friendlyName"]=c.name,f["a.media.length"]=Math.floor(c.length)||"0",f["a.media.playerName"]=e.mPlayerName(),f["a.media.channel"]=e.mChannel(),f["a.media.vsid"]=B.call(this),f["a.media.view"]="true",c.mediaType===I.Audio?(f["&&pev3"]="audio",f["&&ms_a"]="1"):f["&&pev3"]="video",f["&&pe"]="ms_s",d.getDpid()&&(f["&&cid.userId.id"]=d.getDpid()),d.getDpuuid()&&(f["&&cid.puuid.id"]=d.getDpuuid());else if(a==this._ad_start){b=J.getMediaContextData();var g=J.getAdContextData();b&&h.append(f,b),g&&h.append(f,g),c=J.getMediaInfo();var j=J.getAdInfo(),k=J.getAdBreakInfo(),l=i.md5(c.id),m=l+"_"+(k.position||""),n=void 0===k.startTime?J.getCurrentPlayhead():k.startTime;f["a.contentType"]=c.streamType,f["a.media.name"]=c.id,f["a.media.friendlyName"]=c.name,f["a.media.length"]=Math.floor(c.length)||"0",f["a.media.playerName"]=e.mPlayerName(),f["a.media.channel"]=e.mChannel(),f["a.media.vsid"]=B.call(this),f["a.media.ad.name"]=j.id,f["a.media.ad.friendlyName"]=j.name,f["a.media.ad.podFriendlyName"]=k.name||"",f["a.media.ad.length"]=Math.floor(j.length)||"0",f["a.media.ad.playerName"]=k.playerName||e.mPlayerName(),f["a.media.ad.pod"]=m,f["a.media.ad.podPosition"]=Math.floor(j.position)||"0",f["a.media.ad.podSecond"]=Math.floor(n)||"0",f["a.media.ad.view"]=!0,c.mediaType===I.Audio?(f["&&pev3"]="audioAd",f["&&ms_a"]="1"):f["&&pev3"]="videoAd",f["&&pe"]="msa_s",d.getDpid()&&(f["&&cid.userId.id"]=d.getDpid()),d.getDpuuid()&&(f["&&cid.puuid.id"]=d.getDpuuid())}return f}function l(){this._mediaSessionIdValue=null,this._adSessionIdValue=null,this._chapterSessionIdValue=null}function m(a){d.getDpid()&&(a[this._cuser_id]=d.getDpid()),d.getDpuuid()&&(a[this._cuser_puuid]=d.getDpuuid())}function n(a){a[this._analytics_rsid]=e.reportSuiteIDs(),a[this._analytics_trackingserver]=e.trackingServer(),e.ssl()?a[this._analytics_ssl]=1:a[this._analytics_ssl]=0}function o(a){a[this._user_aid]=J.getAdobeAnalyticsID(),a[this._user_mid]=J.getVisitorID(),a[this._user_vid]=J.getUserID()}function p(a){var b=k.getAnalyticsParameters();b&&(b.aamb&&(a[this._aam_blob]=b.aamb),b.aamlh&&(a[this._aam_loc_hint]=b.aamlh))}function q(a){a[this._service_ovp]=e.mOVP(),a[this._service_sdk]=e.mSDK(),a[this._service_channel]=e.mChannel(),a[this._service_playername]=e.mPlayerName(),a[this._service_hbversion]=j.codeVersion,a[this._service_apilevel]=j.mediaAPILevel}function r(a){var b=J.getMediaInfo();b&&(a[this._stream_type]=b.streamType);var c=J.getQoSInfo();if(c){var d=Number(c.droppedFrames),e=Number(c.startupTime),f=Number(c.fps),g=Number(c.bitrate);isNaN(d)||(a[this._stream_droppedFrames]=Math.floor(d)),isNaN(e)||(a[this._stream_startup_time]=Math.floor(e)),isNaN(f)||(a[this._stream_fps]=Math.floor(f)),isNaN(g)||(a[this._stream_bitrate]=Math.floor(g))}}function s(a){var b=J.getMediaInfo();a[this._asset_type]="main",b&&(a[this._asset_mediaid]=b.id,a[this._asset_length]=Math.floor(b.length),a[this._asset_name]=b.name),a[this._asset_publisher]=e.mPublisher()}function t(a,b){var c=J.getCurrentPlayhead();"number"==typeof c&&(a[this._event_playhead]=Math.floor(c)),a[this._event_type]=b,u.call(this,a,b),v.call(this,a,b)}function u(a,b){var c=b;if(J.isInAd()){c=J.getAdInfo().id+"_"+b}var d=ADBMobile_platform.getTimeSince1970Millis(),e=J.getTimeStampForEvent(c);a[this._event_prevts]=e,a[this._event_ts]=d,J.updateTimeStampForEvent(c,d)}function v(a,b){var c=0,d=J.getAssetRefContext();if(d.state&&d.state===b){var e=0,f=a[this._event_ts];if(null!=f&&null!=d.ts&&(e=Math.abs(f-d.ts)),c=e,e>K)G.warning("Resetting duration to 0 as calculated duration ("+e+" ms) exceeds 10 mins"),c=0;else if(d.state===this._media_event_play&&!J.isInAd()){var g=a[this._event_playhead];if(null!=g&&null!=d.playhead){var h=1e3*Math.abs(g-d.playhead),i=Math.abs(e-h);i>L&&(c=Math.min(e,h),G.warning("Resetting duration to "+c+" ms as calculated error delta ("+i+" ms) exceeds 2 secs"))}}}a[this._event_duration]=c}function w(a){a[this._asset_type]="ad";var b=J.getAdBreakInfo();if(b&&!b._isEmptyAdBreak){a[this._asset_resolver]=b.playerName||e.mPlayerName(),a[this._asset_podname]=b.name,a[this._asset_podoffset]=Math.floor(b.startTime);var c=i.md5(a[this._asset_mediaid]);a[this._asset_podid]=c+"_"+b.position}var d=J.getAdInfo();d&&(a[this._asset_adid]=d.id,a[this._asset_adname]=d.name,a[this._asset_adlength]=Math.floor(d.length),a[this._asset_adposition_in_pod]=d.position),a[this._asset_adsid]=D.call(this)}function x(a){a[this._stream_chaptersid]=C.call(this);var b=J.getChapterInfo();if(b){a[this._stream_chapterpos]=b.position;var c=i.md5(a[this._asset_mediaid]);a[this._stream_chapterid]=c+"_"+a[this._stream_chapterpos],a[this._stream_chaptername]=b.name,a[this._stream_chapteroffset]=Math.floor(b.offset),a[this._stream_chapterlength]=Math.floor(b.length)}}function y(a){var b=J.getMediaContextData();if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=this.metaKey+c;a[d]=b[c]}}function z(a){var b=J.getAdContextData();if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=this.metaKey+c;a[d]=b[c]}}function A(a){var b=J.getChapterContextData();if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=this.metaKey+c;a[d]=b[c]}}function B(){return this._mediaSessionIdValue||(this._mediaSessionIdValue=E.call(this)),this._mediaSessionIdValue}function C(){return this._chapterSessionIdValue||(this._chapterSessionIdValue=E.call(this)),this._chapterSessionIdValue}function D(){return this._adSessionIdValue||(this._adSessionIdValue=E.call(this)),this._adSessionIdValue}function E(){return""+ADBMobile_platform.getTimeSince1970Millis()+Math.floor(1e9*Math.random()+1)}function F(){this._analytics_rsid="s:sc:rsid",this._analytics_trackingserver="s:sc:tracking_server",this._analytics_ssl="h:sc:ssl",this._user_aid="s:user:aid",this._user_mid="s:user:mid",this._user_vid="s:user:id",this._aam_blob="s:aam:blob",this._aam_loc_hint="l:aam:loc_hint",this._cuser_id="s:cuser:userId.id",this._cuser_puuid="s:cuser:puuid.id",this._service_sdk="s:sp:sdk",this._service_apilevel="l:sp:hb_api_lvl",this._service_channel="s:sp:channel",this._service_ovp="s:sp:ovp",this._service_playername="s:sp:player_name",this._service_hbversion="s:sp:hb_version",this._asset_type="s:asset:type",this._asset_publisher="s:asset:publisher",this._asset_mediaid="s:asset:video_id",this._asset_length="l:asset:length",this._asset_name="s:asset:name",this._stream_type="s:stream:type",this._stream_droppedFrames="l:stream:dropped_frames",this._stream_startup_time="l:stream:startup_time",this._stream_fps="l:stream:fps",this._stream_bitrate="l:stream:bitrate",this._stream_chaptersid="s:stream:chapter_sid",this._stream_chapterid="s:stream:chapter_id",this._stream_chaptername="s:stream:chapter_name",this._stream_chapteroffset="l:stream:chapter_offset",this._stream_chapterpos="l:stream:chapter_pos",this._stream_chapterlength="l:stream:chapter_length",this._asset_resolver="s:asset:resolver",this._asset_adid="s:asset:ad_id",this._asset_adsid="s:asset:ad_sid",this._asset_adname="s:asset:ad_name",this._asset_adlength="l:asset:ad_length",this._asset_podid="s:asset:pod_id",this._asset_adposition_in_pod="s:asset:pod_position",this._asset_podname="s:asset:pod_name",this._asset_podoffset="l:asset:pod_offset",this._event_sid="s:event:sid",this._event_ts="l:event:ts",this._event_prevts="l:event:prev_ts",this._event_type="s:event:type",this._event_duration="l:event:duration",this._event_playhead="l:event:playhead",this._mediaSessionIdValue=null,this._chapterSessionIdValue=null,this._adSessionIdValue=null,this.metaKey="s:meta:",this._aa_start="aa_start",this._aa_ad_start="aa_ad_start",this._bitrate_change="bitrate_change",this._chapter_start="chapter_start",this._chapter_complete="chapter_complete",this._ad_start="media-ad-start",this._ad_complete="media-ad-complete",this._media_start="media-start",this._media_complete="media-complete",this._media_end="media-end",this._media_resume="resume",this._media_event_play=H.Play,this._media_event_pause=H.Pause,this._media_event_buffer=H.Buffer,this._media_event_stall=H.Stall,this._media_event_start=H.Start,this._error="error"}var G=g.instanceWithTag("media/ParamsResolver"),H=a.Constants.PlayerEvent,I=a.Constants.MediaType,J=a._mediacontext,K=6e5,L=2e3;a._paramsResolver={init:F,resolveDataForEvent:c,getContextData:f,resetSessionIds:l}}(l),function(a){function c(){Ka.init(t.bind(this)),Ia.init(s.bind(this)),Ja.init(),La.init(),this._isEnabled=e.mediaHearbeatEnabled(),this._taskScheduler=new Fa,this._ruleEngine=new Ea,ya.call(this),za.call(this)}function d(a,b){Ca.debug("#::trackSessionStart()");var c=Ea.createContext();c.setData(Qa,a),c.setData(Ua,Ba(b)),xa.call(this,Ma.SessionStart,c)}function f(){Ca.debug("#::trackSessionEnd()"),xa.call(this,Ma.SessionEnd)}function i(){Ca.debug("#::trackPlay()"),xa.call(this,Ma.Play)}function j(){Ca.debug("#::trackPause()"),xa.call(this,Ma.Pause)}function k(){Ca.debug("#::trackComplete()"),xa.call(this,Ma.VideoComplete)}function l(a){Ca.debug("#::trackError()");var b=Ea.createContext();b.setData(Va,a||"unknown_error_id"),b.setData(Wa,"sourceErrorSDK"),xa.call(this,Ma.Error,b)}function m(a,b,c){Ca.debug("#::trackEvent("+a+")");var d,e=Ea.createContext();switch(a){case Da.AdBreakStart:e.setData(Ra,b),e.setData(Ua,Ba(c)),d=Ma.AdBreakStart;break;case Da.AdBreakComplete:case Da.AdBreakSkip:d=Ma.AdBreakComplete;break;case Da.AdStart:e.setData(Sa,b),e.setData(Ua,Ba(c)),d=Ma.AdStart;break;case Da.AdComplete:d=Ma.AdComplete;break;case Da.AdSkip:d=Ma.AdSkip;break;case Da.SeekStart:d=Ma.SeekStart;break;case Da.SeekComplete:d=Ma.SeekComplete;break;case Da.ChapterStart:e.setData(Ta,b),e.setData(Ua,Ba(c)),d=Ma.ChapterStart;break;case Da.ChapterComplete:d=Ma.ChapterComplete;break;case Da.ChapterSkip:d=Ma.ChapterSkip;break;case Da.BufferStart:d=Ma.BufferStart;break;case Da.BufferComplete:d=Ma.BufferComplete;break;case Da.BitrateChange:d=Ma.BitrateChange;break;default:return void Ca.error("#::trackEvent() - Unsupported event.")}xa.call(this,d,e)}function n(a){Ca.debug("#::setDelegate()"),e.mediaHearbeatEnabled()?La.setDelegate(a):Ca.debug("#::setDelegate: ADB Media is not configured correctly.")}function o(){Ca.debug("#::disableMedia()"),xa.call(this,Ma.DisableMedia),xa.call(this,Ma.SessionEnd)}function p(a,b){Ca.debug("[Deprecated] #trackLoad()"),this._trackLoadInfo={mediaInfo:a,contextData:b}}function q(){Ca.debug("[Deprecated] #trackStart()"),this._trackLoadInfo?d.call(this,this._trackLoadInfo.mediaInfo,this._trackLoadInfo.contextData):Ca.debug("[Deprecated] Call #trackLoad(mediaInfo, contextData) before #trackStart()")}function r(){Ca.debug("[Deprecated] #trackUnload()"),f.call(this)}function s(a){switch(a){case Ia._checkstatus_timer:Ka.asyncStatusRequest();break;case Ia._flushfilter_timer:Ka.flushAsyncRequests();break;case Ia._reporting_timer:v.call(this);break;case Ia._playhead_timer:u.call(this)}}function t(b){if(b.trackingDisabled)return Ca.debug("hbSettingsCallback: trackingDisabled flag is set"),void a._mediaHeartbeat.disableMedia();if("number"!=typeof b.setupCheckInterval||isNaN(b.setupCheckInterval))Ca.debug("hbSettingsCallback: setupCheckInterval is invalid");else{Ca.debug("hbSettingsCallback: Updating the check status interval to: "+b.setupCheckInterval);var c=1e3*b.setupCheckInterval;Ia.restartWithNewInterval(Ia._checkstatus_timer,c,!0)}}function u(){var a=La.getCurrentPlayhead(),b=Ea.createContext();b.setData(Xa,a),wa.call(this,b),ta.call(this,b)}function v(){y.call(this)&&(qa.call(this),pa.call(this))}function w(){return!this._isEnabled}function x(){return La.isActiveTracking()}function y(){return La.isActiveSession()}function z(){return!!La.getDelegate()}function A(){return La.isInAd()}function B(){return La.isInAdBreak()}function C(){return La.isInChapter()}function D(){return La.isBuffering()}function E(){return La.isSeeking()}function F(a){var b=a.getData(Qa);if(b&&Ha.isValidMediaInfoObject(b)){var c=b[Ga.MediaResumed];null!=c&&"boolean"!=typeof c&&Ca.warning("Ignoring value set for MediaObjectKey.MediaResumed in MediaObject as we expect a boolean value");var d=b[Ga.PrerollTrackingWaitingTime];if(null!=d){("string"==typeof d||"number"==typeof d)&&!isNaN(d)||Ca.warning("Ignoring value set for MediaObjectKey.PrerollTrackingWaitingTime in MediaObject as we expect a valid duration as number in milliseconds.")}var e=b[Ga.StandardMediaMetadata];return null!=e&&"object"!=typeof e&&Ca.warning("Ignoring value set for MediaObjectKey.StandardMediaMetadata in MediaObject as we expect a valid object with kv pairs."),!0}return!1}function G(a){var b=a.getData(Ra);return b&&Ha.isValidAdBreakInfoObject(b)}function H(a){var b=a.getData(Ra),c=La.getAdBreakInfo();return!(c&&Ha.isSameAdBreakInfoObject(c,b))}function I(a){var b=a.getData(Sa);if(b&&Ha.isValidAdBreakInfoObject(b)){var c=b[Oa];null!=c&&"boolean"!=typeof c&&Ca.warning("Ignoring value set for MediaObjectKey.GranularAdTracking in AdObject as we expect a boolean value.");var d=b[Ga.StandardAdMetadata];return null!=d&&"object"!=typeof d&&Ca.warning("Ignoring value set for MediaObjectKey.StandardAdMetadata in AdObject as we expect a valid object with kv pairs."),!0}return!1}function J(a){var b=a.getData(Sa),c=La.getAdInfo();return!(c&&Ha.isSameAdInfoObject(c,b))}function K(a){var b=a.getData(Ta);return b&&Ha.isValidChapterInfoObject(b)}function L(a){var b=a.getData(Ta),c=La.getChapterInfo();return!(c&&Ha.isSameChapterInfoObject(c,b))}function M(){return!(B()&&!A())}function N(){Ca.debug("#_forceSwitchToBuffering - Forcing into buffer State."),La.forceStateToBuffering(!0),La.resetAssetRefContext()}function O(){Ca.debug("#_restoreToPreviousState - Out of forced buffer State."),La.forceStateToBuffering(!1),La.resetAssetRefContext()}function P(){this._prerollWaitEnabled&&(Ca.debug("Executing deferred API:trackPlay."),this._prerollWaitEnabled=!1,this._playTaskHandle=null,xa.call(this,Ma.Play))}function Q(a){var b=a.getRuleName();if(this._prerollWaitEnabled)if(this._playReceived)switch(b){case Ma.SeekStart:case Ma.BufferStart:Ca.debug("Cancelling scheduled API:trackPlay because of SeekStart/BufferStart event"),this._taskScheduler.cancelTask(this._playTaskHandle),this._playTaskHandle=null;break;case Ma.SeekComplete:case Ma.BufferComplete:Ca.debug("Rescheduled API:trackPlay after SeekComplete/BufferComplete event"),this._playTaskHandle=this._taskScheduler.scheduleTask(P,this,this._prerollWaitTime);break;case Ma.Play:Ca.debug("Dropping API:trackPlay as we already have a API:trackPlay scheduled."),a.stopProcessingAction();break;case Ma.Pause:Ca.debug("Cancelling scheduled API:trackPlay because of API:trackPause call."),this._taskScheduler.cancelTask(this._playTaskHandle),this._playTaskHandle=null,this._prerollWaitEnabled=!1;break;case Ma.AdBreakStart:Ca.debug("Received API:trackEvent(AdBreakStart) within "+this._prerollWaitTime+" ms after API:trackPlay. We will track this as preroll AdBreak."),this._taskScheduler.cancelTask(this._playTaskHandle),this._playTaskHandle=null,this._prerollWaitEnabled=!1}else switch(b){case Ma.Play:Ca.debug("Deferring API:trackPlay for "+this._prerollWaitTime+" ms."),this._playReceived=!0,this._playTaskHandle=this._taskScheduler.scheduleTask(P,this,this._prerollWaitTime),a.stopProcessingAction();break;case Ma.AdBreakStart:Ca.debug("Received trackEvent(AdBreakStart) before first trackPlay."),this._prerollWaitEnabled=!1}}function R(a){a.getRuleName()!==Ma.AdStart||La.hasPlaybackStarted()||xa.call(this,Ma.Play)}function S(){Ca.debug("#_cmdDisableMedia: Media tracking disabled remotely."),this._isEnabled=!1}function T(){Ia.startClockService(),Ka.asyncStatusRequest()}function U(a){var b=a.getData(Qa),c=a.getData(Ua)||{},d=b[Ga.StandardMediaMetadata];d&&"object"==typeof d&&h.append(c,Ba(d)),c[Pa]=b.mediaType;var e=b[Ga.PrerollTrackingWaitingTime];"string"!=typeof e&&"number"!=typeof e||isNaN(e)||(this._prerollWaitTime=Number(e),this._prerollWaitTime<=0&&(this._prerollWaitEnabled=!1));var f=!!b[Ga.MediaResumed];La.setMediaInfo(b),La.setMediaContextData(c),La.setIsActiveTracking(!0),La.setIsActiveSession(!0),Aa.call(this,Ja._media_start),f&&Aa.call(this,Ja._media_resume),La.resetAssetRefContext()}function V(a){La.isActiveSession()||(Ca.debug("API:trackComplete has already cleaned up Heartbeat instance."),X.call(this,a),a.stopProcessingAction())}function W(a){if(La.isActiveSession()){var b=a.getRuleName()===Ma.VideoComplete?Ja._media_complete:Ja._media_end;Aa.call(this,b),La.setIsActiveSession(!1)}}function X(){Ia.stopClockService(),Ka.flushAsyncRequests(),La.setIsActiveTracking(!1),za.call(this)}function Y(a){var b=a.getData(Ra);La.setAdBreakInfo(b),N()}function Z(){La.setAdBreakInfo(null),O()}function $(a){O();var b=a.getData(Sa),c=a.getData(Ua)||{},d=b[Ga.StandardAdMetadata];d&&"object"==typeof d&&h.append(c,Ba(d)),La.setInAdTo(!0),La.setAdInfo(b),La.setAdContextData(c),Aa.call(this,Ja._ad_start),La.resetAssetRefContext();var e=!0,f=b[Oa];"boolean"==typeof f&&(e=f,Ca.debug("#::_cmdAdStart() Overriding granularAdTracking flag to:"+e)),e&&(Ia.restartWithNewInterval(Ia._reporting_timer,_a),Ca.debug("#::_cmdAdStart() Setting AD tracking granularity to:"+_a+"ms"))}function _(){Aa.call(this,Ja._ad_complete),La.setInAdTo(!1),La.setAdContextData(null),La.setAdInfo(null),La.resetAssetRefContext(),Ia.restartWithNewInterval(Ia._reporting_timer,ab),N()}function aa(){La.isInAd()&&(La.setInAdTo(!1),La.setAdInfo(null),La.setAdContextData(null),La.resetAssetRefContext(),Ia.restartWithNewInterval(Ia._reporting_timer,ab),N())}function ba(a){var b=a.getData(Ta),c=a.getData(Ua);La.setInChapterTo(!0),La.setChapterInfo(b),La.setChapterContextData(c),Aa.call(this,Ja._chapter_start),La.resetAssetRefContext(),La.isPlaying()&&pa.call(this,a)}function ca(){Aa.call(this,Ja._chapter_complete),La.setInChapterTo(!1),La.setChapterInfo(null),La.setChapterContextData(null),La.resetAssetRefContext()}function da(){La.isInChapter()&&(La.setInChapterTo(!1),La.setChapterInfo(null),La.setChapterContextData(null),La.resetAssetRefContext())}function ea(){La.setInPaused(!1),La.resetAssetRefContext()}function fa(){La.setInPaused(!0),La.resetAssetRefContext()}function ga(){La.setInSeeking(!0),La.resetAssetRefContext()}function ha(){La.isSeeking()&&(La.setInSeeking(!1),La.resetAssetRefContext())}function ia(){La.setInBuffering(!0),La.resetAssetRefContext()}function ja(){La.isBuffering()&&(La.setInBuffering(!1),La.resetAssetRefContext())}function ka(){Ca.debug("#::_cmdStartPlayheadTimer()"),Ia.startTimer(Ia._playhead_timer)}function la(){Ca.debug("#::_cmdStopPlayheadTimer()"),Ia.stopTimer(Ia._playhead_timer),va.call(this)}function ma(a){var b=Ia.getTimerHandle(Ia._reporting_timer);b&&b.elapsedTime()>250&&pa.call(this,a)}function na(){Aa.call(this,Ja._bitrate_change)}function oa(a){var b=a.getData(Va),c=a.getData(Wa),d={"s:event:source":c,"s:event:id":b};Aa.call(this,Ja._error,d)}function pa(){if(Ca.debug("#_cmdTrackPlaybackState()"),this._isTrackingSuspended)return void Ca.debug("#_cmdTrackPlaybackState: Tracking Suspended, not sending any ping.");if(La.isSeeking())return void Ca.debug("#_cmdTrackPlaybackState: In Seek State, not sending any ping.");Aa.call(this,La.getCurrentPlaybackState()),La.resetAssetRefContext();var a=Ia.getTimerHandle(Ia._reporting_timer);a&&a.reset()}function qa(){if(this._isTrackingSuspended){if(La.isVideoIdle())return void Ca.debug("#_cmdDetectVideoIdle: [Video idle] Stays in suspendTracking");Ca.debug("#_cmdDetectVideoIdle: [Video resumes] suspendTracking -> resumeTracking"),sa.call(this)}if(La.isVideoIdle()&&La.getDurationSinceIdleState()>Za)return Ca.debug("#_cmdDetectVideoIdle: [Video idle] Enters suspendTracking"),void ra.call(this)}function ra(){Ca.debug("#_suspendTracking()"),Aa.call(this,Ja._media_end),this._isTrackingSuspended=!0}function sa(){Ca.debug("#_resumeTracking()");var a,b,c,d,e,f=!1,g=!1;La.isInAd()&&(f=!0,a=La.getAdInfo(),b=La.getAdContextData(),c=La.getAdBreakInfo()),La.isInChapter()&&(g=!0,d=La.getChapterInfo(),e=La.getChapterContextData()),La.resetToResumeState(),Ja.resetSessionIds(),this._isTrackingSuspended=!1,Aa.call(this,Ja._media_start),Aa.call(this,Ja._media_resume),g&&(La.setInChapterTo(!0),La.setChapterInfo(d),La.setChapterContextData(e),Aa.call(this,Ja._chapter_start)),f&&(La.setInAdTo(!0),La.setAdBreakInfo(c),La.setAdInfo(a),La.setAdContextData(b),Aa.call(this,Ja._ad_start)),pa.call(this)}function ta(a){if(La.isInAdBreak())va.call(this);else{var b=a.getData(Xa);b!=this._previousPlayhead?va.call(this):this._previousPlayhead>=0&&!La.isInStall()&&++this._stalledPlayheadCount>=Ya&&ua.call(this),this._previousPlayhead=b}}function ua(){Ca.debug("#_cmdStallStart()"),ma.call(this,null),La.setInStall(!0),La.resetAssetRefContext()}function va(){La.isInStall()&&(Ca.debug("#_cmdStallComplete()"),ma.call(this,null),La.setInStall(!1),La.resetAssetRefContext()),this._stalledPlayheadCount=0}function wa(a){if(!this._contentStarted&&!La.isInAd()&&La.isPlaying()){var b=a.getData(Xa);null==this._firstContentPlayhead?this._firstContentPlayhead=b:b>this._firstContentPlayhead&&(Ca.debug("#_cmdDetectContentStart Sending Content Start Ping"),pa.call(this,a),this._contentStarted=!0)}}function xa(a,b){return this._ruleEngine.processRule(a,b)}function ya(){this._ruleEngine.registerEnterExitAction(Q,R),this._ruleEngine.registerRule(Ma.SessionStart,"API:trackSessionStart",[Ea.createPredicate(z,!0,Na.ErrNoDelegate),Ea.createPredicate(w,!1,Na.ErrMediaDisabled),Ea.createPredicate(x,!1,Na.ErrInTracking),Ea.createPredicate(F,!0,Na.ErrInvalidMediaObject)],[T,U],this),this._ruleEngine.registerRule(Ma.SessionEnd,"API:trackSessionEnd",[Ea.createPredicate(x,!0,Na.ErrNotInTracking)],[V,ma,aa,Z,da,W,X],this),this._ruleEngine.registerRule(Ma.VideoComplete,"API:trackComplete",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia)],[ma,la,aa,Z,da,W],this),this._ruleEngine.registerRule(Ma.Error,"API:trackError",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia)],[oa],this),
this._ruleEngine.registerRule(Ma.Play,"API:trackPlay",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState)],[ma,ha,ja,ea,qa,pa,ka],this),this._ruleEngine.registerRule(Ma.Pause,"API:trackPause",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState),Ea.createPredicate(D,!1,Na.ErrInBuffer),Ea.createPredicate(E,!1,Na.ErrInSeek)],[ma,la,fa,pa],this),this._ruleEngine.registerRule(Ma.BufferStart,"API:trackEvent(BufferStart)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState),Ea.createPredicate(D,!1,Na.ErrInBuffer),Ea.createPredicate(E,!1,Na.ErrInSeek)],[ma,la,ia,pa],this),this._ruleEngine.registerRule(Ma.BufferComplete,"API:trackEvent(BufferComplete)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState),Ea.createPredicate(D,!0,Na.ErrNotInBuffer)],[ma,ja,qa,ka],this),this._ruleEngine.registerRule(Ma.SeekStart,"API:trackEvent(SeekStart)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState),Ea.createPredicate(D,!1,Na.ErrInBuffer),Ea.createPredicate(E,!1,Na.ErrInSeek)],[ma,la,ga],this),this._ruleEngine.registerRule(Ma.SeekComplete,"API:trackEvent(SeekComplete)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(M,!0,Na.ErrInvalidPlayerState),Ea.createPredicate(E,!0,Na.ErrNotInSeek)],[ma,ha,qa,ka],this),this._ruleEngine.registerRule(Ma.AdBreakStart,"API:trackEvent(AdBreakStart)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(G,!0,Na.ErrInvalidAdBreakObject),Ea.createPredicate(H,!0,Na.ErrDuplicateAdBreakObject)],[ma,aa,Z,Y],this),this._ruleEngine.registerRule(Ma.AdBreakComplete,"API:trackEvent(AdBreakComplete)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(B,!0,Na.ErrNotInAdBreak)],[ma,aa,Z],this),this._ruleEngine.registerRule(Ma.AdStart,"API:trackEvent(AdStart)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(B,!0,Na.ErrNotInAdBreak),Ea.createPredicate(I,!0,Na.ErrInvalidAdObject),Ea.createPredicate(J,!0,Na.ErrDuplicateAdObject)],[ma,aa,$],this),this._ruleEngine.registerRule(Ma.AdComplete,"API:trackEvent(AdComplete)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(B,!0,Na.ErrNotInAdBreak),Ea.createPredicate(A,!0,Na.ErrNotInAd)],[ma,_],this),this._ruleEngine.registerRule(Ma.AdSkip,"API:trackEvent(AdSkip)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(B,!0,Na.ErrNotInAdBreak),Ea.createPredicate(A,!0,Na.ErrNotInAd)],[ma,aa],this),this._ruleEngine.registerRule(Ma.ChapterStart,"API:trackEvent(ChapterStart)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(K,!0,Na.ErrInvalidChapterObject),Ea.createPredicate(L,!0,Na.ErrDuplicateChapterObject)],[ma,da,ba],this),this._ruleEngine.registerRule(Ma.ChapterComplete,"API:trackEvent(ChapterComplete)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(C,!0,Na.ErrNotInChapter)],[ma,ca],this),this._ruleEngine.registerRule(Ma.ChapterSkip,"API:trackEvent(ChapterSkip)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia),Ea.createPredicate(C,!0,Na.ErrNotInChapter)],[ma,da],this),this._ruleEngine.registerRule(Ma.BitrateChange,"API:trackEvent(BitrateChange)",[Ea.createPredicate(x,!0,Na.ErrNotInTracking),Ea.createPredicate(y,!0,Na.ErrNotInMedia)],[na],this),this._ruleEngine.registerRule(Ma.DisableMedia,"DisableMedia",[Ea.createPredicate(w,!1,Na.ErrMediaDisabled)],[S],this)}function za(){this._isTrackingSuspended=!1,this._previousPlayhead=-1,this._stalledPlayheadCount=0,this._trackLoadInfo=null,this._prerollWaitEnabled=!0,this._prerollWaitTime=$a,this._playReceived=!1,this._playTaskHandle=null,this._contentStarted=!1,this._firstContentPlayhead=null,this._taskScheduler.clearTasks(),La.resetState(),Ja.resetSessionIds()}function Aa(a,c){if(Ca.debug("#sendHit( "+a+" )"),this._isTrackingSuspended)return void Ca.debug("#sendHit( "+a+" ) - inIdleState");if(this._spyHook_&&"function"==typeof this._spyHook_)return void this._spyHook_.apply(this,arguments);var d=Ja.resolveDataForEvent(a);c&&h.append(d,c),Ka.queueAsyncRequest(d);var e;if(a===Ja._media_start){e=Ja.getContextData(Ja._media_start),b.trackAction("",e);var f=Ja.resolveDataForEvent(Ja._aa_start);Ka.queueAsyncRequest(f)}else if(a===Ja._ad_start){e=Ja.getContextData(Ja._ad_start),b.trackAction("",e);var g=Ja.resolveDataForEvent(Ja._aa_ad_start);Ka.queueAsyncRequest(g)}}function Ba(a){if(null==a||"object"!=typeof a)return null;var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];"number"!=typeof d&&"string"!=typeof d&&"boolean"!=typeof d||(b[c]=d)}return delete b[Pa],b}var Ca=g.instanceWithTag("media/MediaHeartbeat"),Da=a.Constants.Event,Ea=a.RuleEngine,Fa=a.TaskScheduler,Ga=a.Constants.MediaObjectKey,Ha=a.MediaObject,Ia=a._clockservice,Ja=a._paramsResolver,Ka=a._serializeAndSendHeartbeat,La=a._mediacontext,Ma={SessionStart:0,SessionEnd:1,VideoComplete:2,Play:3,Pause:4,Error:5,AdBreakStart:6,AdBreakComplete:7,AdStart:8,AdComplete:9,AdSkip:10,ChapterStart:11,ChapterComplete:12,ChapterSkip:13,SeekStart:14,SeekComplete:15,BufferStart:16,BufferComplete:17,BitrateChange:18,TimedMetadataUpdate:19,DisableMedia:20},Na={ErrMediaDisabled:"Media module is disabled for this publisher. Please contact Adobe Representative to enable tracking.",ErrNoDelegate:'Media module has no delegate set, call "API:setDelegate" to set a valid delgate before starting a tracking session.',ErrNotInTracking:'Media module is not in active tracking session, call "API:trackSessionStart" to begin a new tracking session.',ErrInTracking:'Media module is in active tracking session, call "API:trackSessionEnd" to end current tracking session.',ErrNotInMedia:'Media module has completed tracking session, call "API:trackSessionEnd" first to end current session and then begin a new tracking session.',ErrInBuffer:'Media module is tracking buffer events, call "API:trackEvent(BufferComplete)" first to stop tracking buffer events.',ErrNotInBuffer:'Media module is not tracking buffer events, call "API:trackEvent(BufferStart)" before "API:trackEvent(BufferComplete)".',ErrInSeek:'Media module is tracking seek events, call "API:trackEvent(SeekComplete)" first to stop tracking seek events.',ErrNotInSeek:'Media module is not tracking seek events, call "API:trackEvent(SeekStart)" before "API:trackEvent(SeekComplete)".',ErrNotInAdBreak:'Media module is not tracking any AdBreak, call "API:trackEvent(AdBreakStart)" to begin tracking AdBreak',ErrNotInAd:'Media module is not tracking any Ad, call "API:trackEvent(AdStart)" to begin tracking Ad',ErrNotInChapter:'Media module is not tracking any Chapter, call "API:trackEvent(ChapterStart)" to begin tracking Chapter',ErrInvalidMediaObject:'MediaInfo passed into "API:trackSessionStart" is invalid.',ErrInvalidAdBreakObject:'AdBreakInfo passed into "API:trackEvent(AdBreakStart)" is invalid.',ErrDuplicateAdBreakObject:'Media module is currently tracking the AdBreak passed into "API:trackEvent(AdBreakStart)".',ErrInvalidAdObject:'AdInfo passed into "API:trackEvent(AdStart)" is invalid.',ErrDuplicateAdObject:'Media module is currently tracking the Ad passed into "API:trackEvent(AdStart)".',ErrInvalidChapterObject:'ChapterInfo passed into "API:trackEvent(ChapterStart)" is invalid.',ErrDuplicateChapterObject:'Media module is currently tracking the Chapter passed into "API:trackEvent(ChapterStart)".',ErrInvalidTimedMetadataObject:'TimedMetadata passed into "API:trackEvent(TimedMetadataUpdate)" is invalid.',ErrInvalidPlayerState:"MediaHeartbeat is tracking an AdBreak but not tracking any Ad and will drop any calls to track player state (Play, Pause, Buffer or Seek) in this state."},Oa="granular_ad_tracking",Pa="a.media.streamType",Qa="key_media_object",Ra="key_adbreak_object",Sa="key_ad_object",Ta="key_chapter_object",Ua="key_custom_metadata",Va="key_error_id",Wa="key_error_source",Xa="key_playhead",Ya=2,Za=18e5,$a=250,_a=1e3,ab=1e4;a._mediaHeartbeat={init:c,disableMedia:o,setDelegate:n,trackSessionStart:d,trackSessionEnd:f,trackPlay:i,trackPause:j,trackComplete:k,trackEvent:m,trackError:l,trackLoad:p,trackUnload:r,trackStart:q},a._MediaHeartbeatErrorMessage=Na}(l),function(a){var b=a._mediaHeartbeat,c=a.Constants,d=a.MediaObject;a.init=b.init.bind(b),a.setDelegate=b.setDelegate.bind(b),a.trackSessionStart=b.trackSessionStart.bind(b),a.trackSessionEnd=b.trackSessionEnd.bind(b),a.trackPlay=b.trackPlay.bind(b),a.trackPause=b.trackPause.bind(b),a.trackComplete=b.trackComplete.bind(b),a.trackEvent=b.trackEvent.bind(b),a.trackError=b.trackError.bind(b),a.trackStart=b.trackStart.bind(b),a.trackLoad=b.trackLoad.bind(b),a.trackUnload=b.trackUnload.bind(b),a.MediaType=c.MediaType,a.StreamType=c.StreamType,a.Event=c.Event,a.MediaObjectKey=c.MediaObjectKey,a.VideoMetadataKeys=c.VideoMetadataKeys,a.AudioMetadataKeys=c.AudioMetadataKeys,a.AdMetadataKeys=c.AdMetadataKeys,a.createMediaObject=d.createMediaObject,a.createAdBreakObject=d.createAdBreakObject,a.createChapterObject=d.createChapterObject,a.createAdObject=d.createAdObject,a.createQoSObject=d.createQoSObject,a.MediaInfo=d.MediaInfo,a.AdBreakInfo=d.AdBreakInfo,a.AdInfo=d.AdInfo,a.ChapterInfo=d.ChapterInfo,a.QoSInfo=d.QoSInfo}(l);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(b=b.toString(),this.values)for(var c=0;c<this.values.length;++c)if(-1!==b.indexOf(this.values[c]))return!0;return!1},a.MatcherContains=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){var c=a.length-b.length,d=a.lastIndexOf(b,c);return-1!==d&&d===c}function c(a,b){this.key=a,this.values=b}c.prototype.matches=function(a){var c=a[this.key];if("string"!=typeof c&&"number"!=typeof c)return!1;if(c=c.toString(),this.values)for(var d=0;d<this.values.length;++d)if(b(c,this.values[d].toString()))return!0;return!1},a.MatcherEndsWith=c}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(b=b.toString(),this.values)for(var c=0;c<this.values.length;++c)if(b===this.values[c].toString())return!0;return!1},a.MatcherEquals=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){return void 0!==a[this.key]},a.MatcherExists=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(isNaN(Number(b)))return!1;if(this.values)for(var c=0;c<this.values.length;++c)if(Number(b)>Number(this.values[c]))return!0;return!1},a.MatcherGreaterThan=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(isNaN(Number(b)))return!1;if(this.values)for(var c=0;c<this.values.length;++c)if(Number(b)>=Number(this.values[c]))return!0;return!1},a.MatcherGreaterThanOrEqual=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(isNaN(Number(b)))return!1;if(this.values)for(var c=0;c<this.values.length;++c)if(Number(b)<Number(this.values[c]))return!0;return!1},a.MatcherLessThan=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){this.key=a,this.values=b}b.prototype.matches=function(a){var b=a[this.key];if("string"!=typeof b&&"number"!=typeof b)return!1;if(isNaN(Number(b)))return!1;if(this.values)for(var c=0;c<this.values.length;++c)if(Number(b)<=Number(this.values[c]))return!0;return!1},a.MatcherLessThanOrEqual=b}(m);var m=m||{};!function(a){"use strict";function b(b,c){this.containsHandler=new a.MatcherContains(b,c)}b.prototype.matches=function(a){return!this.containsHandler.matches(a)},a.MatcherNotContains=b}(m);var m=m||{};!function(a){"use strict";function b(b,c){this.equalsHandler=new a.MatcherEquals(b,c)}b.prototype.matches=function(a){return!this.equalsHandler.matches(a)},a.MatcherNotEquals=b}(m);var m=m||{};!function(a){"use strict";function b(b,c){this._handler=new a.MatcherExists(b,c)}b.prototype.matches=function(a){return!this._handler.matches(a)},a.MatcherNotExists=b}(m);var m=m||{};!function(a){"use strict";function b(a,b){return 0===a.indexOf(b)}function c(a,b){this.key=a,this.values=b}c.prototype.matches=function(a){var c=a[this.key];if("string"!=typeof c&&"number"!=typeof c)return!1;if(c=c.toString(),this.values)for(var d=0;d<this.values.length;++d)if(b(c,this.values[d].toString()))return!0;return!1},a.MatcherStartsWith=c}(m);var n=function(){function a(a){return this.JSON_CONFIG_TEMPLATE="template",this.JSON_CONFIG_MESSAGE_ID="messageId",this.JSON_CONFIG_SHOW_RULE="showRule",this.JSON_CONFIG_START_DATE="startDate",this.MESSAGE_JSON_PAYLOAD="payload",this.JSON_CONFIG_END_DATE="endDate",this.JSON_CONFIG_SHOW_OFFLINE="showOffline",this.JSON_CONFIG_AUDIENCES="audiences",this.JSON_CONFIG_TRIGGERS="triggers",this.JSON_CONFIG_ASSETS="assets",this.MESSAGE_IMAGE_CACHE_DIR="messageImages",this.JSON_DEFAULT_START_DATE=0,this.JSON_DEFAULT_SHOW_OFFLINE="false",this.MESSAGE_ENUM_STRING_UNKNOWN="unknown",this.MESSAGE_SHOW_RULE_STRING_ALWAYS="always",this.MESSAGE_SHOW_RULE_STRING_ONCE="once",this.MESSAGE_SHOW_RULE_STRING_UNTIL_CLICK="untilClick",this.MESSAGE_TEMPLATE_STRING_ALERT="alert",this.MESSAGE_TEMPLATE_STRING_FULLSCREEN="fullscreen",this.MESSAGE_TEMPLATE_STRING_LOCAL_NOTIFICATION="local",this.MESSAGE_TEMPLATE_STRING_CALLBACK="callback",this.MESSAGE_TYPE_HANDLER="handler",this.MESSAGE_TYPE="type",this.COMBINED_VARS="combinedVars",this.ADB_TEMPLATE_CALLBACK_URL="templateurl",this.ADB_TEMPLATE_CALLBACK_BODY="templatebody",this.ADB_TEMPLATE_CALLBACK_TYPE="contenttype",this.ADB_TEMPLATE_CALLBACK_TIMEOUT="timeout",this.ADB_TEMPLATE_TOKEN_START="{",this.ADB_TEMPLATE_TOKEN_END="}",this.ADB_TEMPLATE_TIMEOUT_DEFAULT=2,this.message={},this.message[this.JSON_CONFIG_MESSAGE_ID]="",this.message[this.JSON_CONFIG_TEMPLATE]="",this.message[this.MESSAGE_TYPE_HANDLER]=null,this.message[this.JSON_CONFIG_START_DATE]=this.JSON_DEFAULT_START_DATE,this.message[this.JSON_CONFIG_END_DATE]=null,this.message[this.JSON_DEFAULT_SHOW_OFFLINE]=this.JSON_DEFAULT_SHOW_OFFLINE,this.message[this.JSON_CONFIG_AUDIENCES]=[],this.message[this.JSON_CONFIG_TRIGGERS]=[],this.message[this.MESSAGE_TYPE]=null,this.message[this.COMBINED_VARS]={},this.validLetters={},this.validLetters.a=1,this.validLetters.b=1,this.validLetters.c=1,this.validLetters.d=1,this.validLetters.e=1,this.validLetters.f=1,this.validLetters.g=1,this.validLetters.h=1,this.validLetters.i=1,this.validLetters.j=1,this.validLetters.k=1,this.validLetters.l=1,this.validLetters.m=1,this.validLetters.n=1,this.validLetters.o=1,this.validLetters.p=1,this.validLetters.q=1,this.validLetters.r=1,this.validLetters.s=1,this.validLetters.t=1,this.validLetters.u=1,this.validLetters.v=1,this.validLetters.w=1,this.validLetters.x=1,this.validLetters.y=1,this.validLetters.z=1,this.validLetters[0]=1,this.validLetters[1]=1,this.validLetters[2]=1,this.validLetters[3]=1,this.validLetters[4]=1,this.validLetters[5]=1,this.validLetters[6]=1,this.validLetters[7]=1,this.validLetters[8]=1,this.validLetters[9]=1,this.validLetters._=1,this.validLetters["."]=1,this.validLetters["%"]=1,b.call(this,a)?this:(g.warning("Message - Initialization failed"),null)}function b(a){if("object"==typeof a)return a[this.JSON_CONFIG_TEMPLATE]?(this.message[this.JSON_CONFIG_TEMPLATE]=a[this.JSON_CONFIG_TEMPLATE],this.message[this.JSON_CONFIG_TEMPLATE]!=this.MESSAGE_TEMPLATE_STRING_CALLBACK?(g.warning("Message - unable to create instance of message with that template"),!1):(this.message[this.MESSAGE_TYPE]=this.MESSAGE_TEMPLATE_STRING_CALLBACK,c.call(this,a))):(g.warning("Message - template is required for postback message"),!1)}function c(a){if(a){if(!a[this.JSON_CONFIG_MESSAGE_ID]||""===a[this.JSON_CONFIG_MESSAGE_ID])return g.warning("Message - unable to create instance of message without message id"),!1;if(this.message[this.JSON_CONFIG_MESSAGE_ID]=a[this.JSON_CONFIG_MESSAGE_ID],!a[this.MESSAGE_JSON_PAYLOAD])return g.warning("Data Callback - Unable to create data callback. payload is empty"),!1;this.message[this.MESSAGE_JSON_PAYLOAD]=a[this.MESSAGE_JSON_PAYLOAD];if(!d.call(this))return!1;if(a[this.JSON_CONFIG_SHOW_RULE]&&""!==a[this.JSON_CONFIG_SHOW_RULE]){if(a[this.JSON_CONFIG_SHOW_RULE]==this.message[this.MESSAGE_ENUM_STRING_UNKNOWN])return g.warning("Message - Messages - Unable to create message. showrule is invalid"),!1;if(!f.call(this,a[this.JSON_CONFIG_SHOW_RULE]))return g.warning("Message - unsupported message rule"),!1;this.message[this.JSON_CONFIG_SHOW_RULE]=a[this.JSON_CONFIG_SHOW_RULE]}var b;if(b=a[this.JSON_CONFIG_START_DATE]&&""!==a[this.JSON_CONFIG_START_DATE]?a[this.JSON_CONFIG_START_DATE]:this.JSON_DEFAULT_START_DATE,this.message[this.JSON_CONFIG_START_DATE]=b,!a[this.JSON_CONFIG_END_DATE]||""===a[this.JSON_CONFIG_END_DATE])return g.warning("Message - cannot create message. endDate is invalid."),!1;this.message[this.JSON_CONFIG_END_DATE]=a[this.JSON_CONFIG_END_DATE],a[this.JSON_CONFIG_SHOW_OFFLINE]&&""!==a[this.JSON_CONFIG_SHOW_OFFLINE]?this.message[this.JSON_CONFIG_SHOW_OFFLINE]=a[this.JSON_CONFIG_SHOW_OFFLINE]:this.message[this.JSON_CONFIG_SHOW_OFFLINE]=this.message[this.JSON_DEFAULT_SHOW_OFFLINE];var c,e;if(a[this.JSON_CONFIG_AUDIENCES]){var h=a[this.JSON_CONFIG_AUDIENCES];for(e=0;e<h.length;++e){var i=h[e];c=new o.Matcher(i),this.message[this.JSON_CONFIG_AUDIENCES].push(c)}}if(a[this.JSON_CONFIG_TRIGGERS]){var j=a[this.JSON_CONFIG_TRIGGERS];for(e=0;e<j.length;++e){var k=j[e];c=new o.Matcher(k),this.message[this.JSON_CONFIG_TRIGGERS].push(c)}return this.message[this.JSON_CONFIG_TRIGGERS].length<=0?(g.warning("Messages - Unable to load message - at least one valid trigger is required for a message."),!1):(g.debug("Messages - "+this.message[this.JSON_CONFIG_TRIGGERS].length+" triggers found"),!0)}return g.warning("Messages - empty messages"),!1}}function d(){var a=this.message[this.MESSAGE_JSON_PAYLOAD];return a[this.ADB_TEMPLATE_CALLBACK_URL]&&""!==a[this.ADB_TEMPLATE_CALLBACK_URL]?(this.message[this.ADB_TEMPLATE_CALLBACK_URL]=a[this.ADB_TEMPLATE_CALLBACK_URL],a[this.ADB_TEMPLATE_CALLBACK_TIMEOUT]?this.message[this.ADB_TEMPLATE_CALLBACK_TIMEOUT]=a[this.ADB_TEMPLATE_CALLBACK_TIMEOUT]:(g.warning("Data Callback - setting default timeout"),this.message[this.ADB_TEMPLATE_CALLBACK_TIMEOUT]=this.message[this.ADB_TEMPLATE_TIMEOUT_DEFAULT]),a[this.ADB_TEMPLATE_CALLBACK_BODY]&&""!==a[this.ADB_TEMPLATE_CALLBACK_BODY]?(this.message[this.ADB_TEMPLATE_CALLBACK_BODY]=a[this.ADB_TEMPLATE_CALLBACK_BODY],this.message[this.ADB_TEMPLATE_CALLBACK_TYPE]=a[this.ADB_TEMPLATE_CALLBACK_TYPE]):g.warning("Data Callback - Unable to read templatebody. This is not a required field"),!0):(g.warning("Data Callback - Unable to create data callback. templateurl is required"),!1)}function f(a){return a===this.MESSAGE_SHOW_RULE_STRING_ALWAYS||a===this.MESSAGE_SHOW_RULE_STRING_ONCE}function i(a){return a}function l(a){var b={};k.getMarketingCloudIDAsync(function(a){b["%mcid%"]=a}),b["%timestampz%"]=ADBMobile_platform.getDateInISOString(),b["%timestampu%"]=ADBMobile_platform.getTimeSince1970(),b["%sdkver%"]=j.codeVersion,b["%cachebust%"]=""+1e8*Math.random();var c=h.serializeParameters(a);if(c.length>2&&(c=c.substring(1)),b["%all_url%"]=c,a){var d=JSON.stringify(a);d&&(b["%all_json%"]=d)}return b}function m(a){var b=[];if(a&&""!==a){var c,d=a.length;for(c=0;c<d;c++){if(a.substring(c,c+1)===this.ADB_TEMPLATE_TOKEN_START){var e;for(e=c+1;e<d;e++){if(a.substring(e,e+1)===this.ADB_TEMPLATE_TOKEN_END)break}if(e==d)break;var f=a.substring(c,e+1);!0===r.call(this,f.substring(1,f.length-1))&&(b.push(f),c=e)}}}else g.warning("findTokensForExpansion: empty string with tokens");return b}function n(a,b){var c={},d=this.message[this.COMBINED_VARS]||{};if(a)for(var e=0;e<a.length;++e){var f=a[e],g=f.substring(1,f.length-1).toLowerCase(),h=d[g];c[f]=h?b?encodeURIComponent(h):h:""}return c}function p(a,b){var c,d=a;for(c in b)if(b.hasOwnProperty(c))for(;-1!=d.indexOf(c);){var e=d.indexOf(c),f=b[c],g=d.slice(0,e),h=d.slice(e+c.length);d=""!==f?g+f+h:g+h}return d}function q(a,b){e.getPrivacyStatus()===e.PRIVACY_STATUS_OPT_IN&&(g.debug("Messaging - Sending signal request ("+a.toString()+")"),ADBMobile_platform.httpRequestAsync(a,"POST",{"Content-type":"application/x-www-form-urlencoded"},b,2e3,function(a,b,c){200==a?g.debug("Messaging - Successfully sent hit ("+c+")"):g.error("Messaging - Unable to send hit ("+c+") response ("+b+")")}))}function r(a){var b,c=!0;for(b=0;b<a.length;b++){var d=a.charAt(b).toLowerCase();if(!this.validLetters[d]){c=!1;break}}return c}return a.prototype.shouldShowForVariables=function(a,b){var c={};if(b&&h.append(c,b),a&&h.append(c,a),h.append(c,l.call(this,c)),this.message[this.COMBINED_VARS]=c,this.message[this.JSON_CONFIG_START_DATE]&&ADBMobile_platform.getTimeSince1970()<this.message[this.JSON_CONFIG_START_DATE])return!1;if(this.message[this.JSON_CONFIG_END_DATE]&&ADBMobile_platform.getTimeSince1970()>this.message[this.JSON_CONFIG_END_DATE])return!1;var d=this.message[this.JSON_CONFIG_TRIGGERS];if(d)for(var e=i.call(this,b),f=0;f<d.length;++f){var g=d[f];if(!g.matchesInMaps(a,e))return!1}return!0},a.prototype.show=function(){var a=this.message[this.ADB_TEMPLATE_CALLBACK_URL],b=a,c=m.call(this,a),d=n.call(this,c,!0),e=["{%all_url%}"],f=n.call(this,e,!1);h.append(d,f),d&&(b=p.call(this,a,d));var g=this.message[this.ADB_TEMPLATE_CALLBACK_BODY],i=g;if(g){var j=ADBMobile_platform.decodeBase64String(g),k=m.call(this,j),l=this.message[this.ADB_TEMPLATE_CALLBACK_TYPE],o=!0;l&&-1!=l.toLowerCase().search("application/json")&&(o=!1);var r=n.call(this,k,o),s=[];s.push("{%all_url%}"),s.push("{%all_json%}");var t=n.call(this,s,!1);h.append(r,t),r&&(i=p.call(this,j,r))}q.call(this,b,i)},{Message:a}}(),o=function(){"use strict";function a(a,b,c){if(!m||!a||!b)return null;var d=null;switch(a){case"eq":d=m.MatcherEquals;break;case"ne":d=m.MatcherNotEquals;break;case"gt":d=m.MatcherGreaterThan;break;case"lt":d=m.MatcherLessThan;break;case"ge":d=m.MatcherGreaterThanOrEqual;break;case"le":d=m.MatcherLessThanOrEqual;break;case"co":d=m.MatcherContains;break;case"nc":d=m.MatcherNotContains;break;case"sw":d=m.MatcherStartsWith;break;case"ew":d=m.MatcherEndsWith;break;case"ex":d=m.MatcherExists;break;case"nx":d=m.MatcherNotExists}var e=b.toLowerCase();return d?new d(e,c):null}function b(b){return b&&(this._json=b,this._handler=a(b.matches,b.key,b.values)),this}return b.prototype.matchesInMaps=function(a,b){if(this._handler){var c={};return h.append(c,a),h.append(c,b),this._handler.matches(c)}return!1},{Matcher:b}}(),p=function(){function a(){k=[],l=!1,m=[]}function b(a){if(a){for(var b=[],c=0;c<a.length;++c)"callback"===a[c].template&&b.push(new n.Message(a[c]));k=b}}function c(){for(var a=0;a<m.length;++a)i(m[a].vars,m[a].cData);m=[],l=!0}function d(){b(e.getMessages());var a=e.getRemotes();a&&a.messages?ADBMobile_platform.httpRequestAsync(a.messages,"GET",{},null,500,function(a,d){if(200==a&&d)try{b(JSON.parse(d).messages)}catch(e){g.debug("remotes.messages - Unable to parse response ("+e+")")}c()}):c()}function f(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=c.toLowerCase();b[d]=a[c]}return b}function i(a,b){try{if(k&&k.length>0)for(var c=f(a),d=f(b),e=0;e<k.length;++e){var h=k[e];h&&h.shouldShowForVariables(c,d)&&h.show()}}catch(i){g.warning("Messages - checkFor3rdPartyCallbacks Failed with exception "+i.message)}}function j(a,b){if(a&&b)return l?void i(a,b):void m.push({vars:h.clone(a),cData:h.clone(b)})}var k=[],l=!1,m=[];return{init:d,checkFor3rdPartyCallbacks:j,reset:a}}();!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[14+(c+64>>>9<<4)]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}a.md5=t}(i);var q={version:j,analytics:{trackState:b.trackState,trackAction:b.trackAction,getTrackingIdentifier:a.getAIDAsync},config:{setUserIdentifier:e.setUserIdentifier,getUserIdentifier:e.getUserIdentifier,getAllIdentifiersAsync:e.getAllIdentifiersAsync,setPrivacyStatus:e.setPrivacyStatus,getPrivacyStatus:e.getPrivacyStatus,setLoggerCallback:g.setLoggerCallback,setDebugLogging:g.setDebugLogging,getDebugLogging:g.getDebugLogging,PRIVACY_STATUS_OPT_IN:e.PRIVACY_STATUS_OPT_IN,PRIVACY_STATUS_OPT_OUT:e.PRIVACY_STATUS_OPT_OUT},visitor:{syncIdentifiers:k.idSync,getMarketingCloudID:k.getMarketingCloudIDAsync},audienceManager:{submitSignal:d.submitSignal,getVisitorProfile:d.getVisitorProfile,getDpid:d.getDpid,getDpuuid:d.getDpuuid,setDpidAndDpuuid:d.setDpidAndDpuuid},media:{setDelegate:l.setDelegate,trackSessionStart:l.trackSessionStart,trackPlay:l.trackPlay,trackPause:l.trackPause,trackError:l.trackError,trackEvent:l.trackEvent,trackComplete:l.trackComplete,trackSessionEnd:l.trackSessionEnd,StreamType:l.StreamType,MediaType:l.MediaType,Event:l.Event,MediaObjectKey:l.MediaObjectKey,VideoMetadataKeys:l.VideoMetadataKeys,AudioMetadataKeys:l.AudioMetadataKeys,AdMetadataKeys:l.AdMetadataKeys,createMediaObject:l.createMediaObject,createAdBreakObject:l.createAdBreakObject,createChapterObject:l.createChapterObject,createAdObject:l.createAdObject,createQoSObject:l.createQoSObject,trackLoad:l.trackLoad,trackStart:l.trackStart,trackUnload:l.trackUnload,MediaInfo:l.MediaInfo,AdInfo:l.AdInfo,ChapterInfo:l.ChapterInfo,AdBreakInfo:l.AdBreakInfo,QoSInfo:l.QoSInfo,BUFFER_START:l.Event.BufferStart,BUFFER_COMPLETE:l.Event.BufferComplete,SEEK_START:l.Event.SeekStart,SEEK_COMPLETE:l.Event.SeekComplete,BITRATE_CHANGE:l.Event.BitrateChange,CHAPTER_START:l.Event.ChapterStart,CHAPTER_COMPLETE:l.Event.ChapterComplete,CHAPTER_SKIP:l.Event.ChapterSkip,AD_BREAK_START:l.Event.AdBreakStart,AD_BREAK_COMPLETE:l.Event.AdBreakComplete,AD_BREAK_SKIP:l.Event.AdBreakSkip,AD_START:l.Event.AdStart,AD_COMPLETE:l.Event.AdComplete,AD_SKIP:l.Event.AdSkip,STREAM_TYPE_LIVE:l.StreamType.LIVE,STREAM_TYPE_VOD:l.StreamType.VOD}};return e.init(),a.init(),k.init(),p.init(),l.init(),q}();